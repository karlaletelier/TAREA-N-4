//
//  Copyright 2017 mParticle, Inc.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//
//  Uses portions of code from jQuery
//  jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license

window.mParticle = window.mParticle || {};
window.mParticle.config = window.mParticle.config || {};
window.mParticle.config.serviceUrl = 'jssdk.mparticle.com/v2/JS/';
window.mParticle.config.secureServiceUrl = 'jssdks.mparticle.com/v2/JS/';
window.mParticle.config.appName = "Fenty";
window.mParticle.config.minWebviewBridgeVersion = 1;
window.mParticle.config.workspaceToken = "52762528";
window.mParticle.config.aliasMaxWindow = 90;
(function(){function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i||n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}return n})()({1:[function(n,t){function e(n,t,f){var a,p=mParticle.Identity.getCurrentUser(),c,w,v,y,l;if(p&&(a=p.getMPID()),mParticle.Store.webviewBridgeEnabled)o.sendToNative(u.NativeSdkPaths.LogEvent,JSON.stringify(n));else{if(w=function(){c.readyState===4&&(mParticle.Logger.verbose("Received "+c.statusText+" from server"),f(c.responseText))},mParticle.Logger.verbose(r.InformationMessages.SendBegin),v=[],i.isObject(n.UserIdentities)&&Object.keys(n.UserIdentities).length){for(y in n.UserIdentities)l={},l.Identity=n.UserIdentities[y],l.Type=i.parseNumber(y),v.push(l);n.UserIdentities=v}else n.UserIdentities=[];if(mParticle.Store.requireDelay=i.isDelayedByIntegration(mParticle.preInit.integrationDelays,mParticle.Store.integrationDelayTimeoutStart,Date.now()),!a||mParticle.Store.requireDelay)mParticle.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay."),mParticle.Store.eventQueue.push(n);else{if(i.processQueuedEvents(mParticle.Store.eventQueue,a,!mParticle.Store.requiredDelay,e,t,f),!n){mParticle.Logger.error(r.ErrorMessages.EventEmpty);return}if(mParticle.Logger.verbose(r.InformationMessages.SendHttp),c=i.createXHR(w),c)try{c.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken)+"/Events");c.send(JSON.stringify(s.convertEventToDTO(n,mParticle.Store.isFirstRun,mParticle.Store.currencyCode,mParticle.Store.integrationAttributes)));n.EventName!==h.MessageType.AppStateTransition&&t(n)}catch(b){mParticle.Logger.error("Error sending event to mParticle servers. "+b)}}}}function c(n,t){var u,o=function(){var n,r;if(u.readyState===4){if(mParticle.Logger.verbose("Received "+u.statusText+" from server"),u.status!==200&&u.status!==202&&u.responseText&&(n=JSON.parse(u.responseText),n.hasOwnProperty("message"))){r=n.message;i.invokeAliasCallback(t,u.status,r);return}i.invokeAliasCallback(t,u.status)}};if(mParticle.Logger.verbose(r.InformationMessages.SendAliasHttp),u=i.createXHR(o),u)try{u.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.aliasUrl,mParticle.Store.devToken)+"/Alias");u.send(JSON.stringify(n))}catch(e){i.invokeAliasCallback(t,f.noHttpCoverage,e);mParticle.Logger.error("Error sending alias request to mParticle servers. "+e)}}function l(n,t,u,e,o,s){var h,c,a=function(){h.readyState===4&&(mParticle.Logger.verbose("Received "+h.statusText+" from server"),o(h,c,u,e,t))};if(mParticle.Logger.verbose(r.InformationMessages.SendIdentityBegin),!n){mParticle.Logger.error(r.ErrorMessages.APIRequestEmpty);return}if(mParticle.Logger.verbose(r.InformationMessages.SendIdentityHttp),h=i.createXHR(a),h)try{mParticle.Store.identityCallInFlight?i.invokeCallback(u,f.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"):(c=s||null,t==="modify"?h.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+s+"/"+t):h.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+t),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("x-mp-key",mParticle.Store.devToken),mParticle.Store.identityCallInFlight=!0,h.send(JSON.stringify(n)))}catch(l){mParticle.Store.identityCallInFlight=!1;i.invokeCallback(u,f.noHttpCoverage,l);mParticle.Logger.error("Error sending identity request to servers with status code "+h.status+" - "+l)}}function a(n,t){var r,u;try{r=i.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken);u={uuid:i.generateUniqueId(),data:n};t&&(t.open("post",r+"/Forwarding"),t.send(JSON.stringify(u)))}catch(f){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}}function v(n){var r,u,f,t;try{f=function(){t.readyState===4&&t.status===202&&mParticle.Logger.verbose("Successfully sent  "+t.statusText+" from server")};t=i.createXHR(f);r=i.createServiceUrl(mParticle.Store.SDKConfig.v1SecureServiceUrl,mParticle.Store.devToken);u=n;t&&(t.open("post",r+"/Forwarding"),t.send(JSON.stringify(u)))}catch(e){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}}var i=n("./helpers"),u=n("./constants"),o=n("./nativeSdkHelpers"),f=u.HTTPCodes,s=n("./serverModel"),h=n("./types"),r=u.Messages;t.exports={sendEventToServer:e,sendIdentityRequest:l,sendBatchForwardingStatsToServer:a,sendSingleForwardingStatsToServer:v,sendAliasRequest:c}},{"./constants":3,"./helpers":9,"./nativeSdkHelpers":15,"./serverModel":18,"./types":21}],2:[function(n,t){function r(n,t,i,r,u){return typeof n!="boolean"?(mParticle.Logger.error("Consented boolean is required when constructing a GDPR Consent object."),null):t&&isNaN(t)?(mParticle.Logger.error("Timestamp must be a valid number when constructing a GDPR Consent object."),null):i&&typeof i!="string"?(mParticle.Logger.error("Document must be a valid string when constructing a GDPR Consent object."),null):r&&typeof r!="string"?(mParticle.Logger.error("Location must be a valid string when constructing a GDPR Consent object."),null):u&&typeof u!="string"?(mParticle.Logger.error("Hardware ID must be a valid string when constructing a GDPR Consent object."),null):{Consented:n,Timestamp:t||Date.now(),ConsentDocument:i,Location:r,HardwareId:u}}function u(n){function u(n){if(typeof n!="string")return null;var t=n.trim();return t.length?t.toLowerCase():null}function f(n){if(n){if(i.isObject(n)){t={};for(var r in n)n.hasOwnProperty(r)&&e(r,n[r])}}else t={};return this}function e(n,f){var o=u(n),e;return o?i.isObject(f)?(e=r(f.Consented,f.Timestamp,f.ConsentDocument,f.Location,f.HardwareId),e&&(t[o]=e),this):(mParticle.Logger.error("addGDPRConsentState() invoked with bad or empty GDPR consent object."),this):(mParticle.Logger.error("addGDPRConsentState() invoked with bad purpose. Purpose must be a string."),this)}function o(n){var i=u(n);return i?(delete t[i],this):this}function s(){return i.extend({},t)}var t={};return n&&f(n.getGDPRConsentState()),{setGDPRConsentState:f,addGDPRConsentState:e,getGDPRConsentState:s,removeGDPRConsentState:o}}var i=n("./helpers"),f={toMinifiedJsonObject:function(n){var r={},u,i,t;if(n&&(u=n.getGDPRConsentState(),u)){r.gdpr={};for(i in u)u.hasOwnProperty(i)&&(t=u[i],r.gdpr[i]={},typeof t.Consented=="boolean"&&(r.gdpr[i].c=t.Consented),typeof t.Timestamp=="number"&&(r.gdpr[i].ts=t.Timestamp),typeof t.ConsentDocument=="string"&&(r.gdpr[i].d=t.ConsentDocument),typeof t.Location=="string"&&(r.gdpr[i].l=t.Location),typeof t.HardwareId=="string"&&(r.gdpr[i].h=t.HardwareId))}return r},fromMinifiedJsonObject:function(n){var i=u(),t,f;if(n.gdpr)for(t in n.gdpr)n.gdpr.hasOwnProperty(t)&&(f=r(n.gdpr[t].c,n.gdpr[t].ts,n.gdpr[t].d,n.gdpr[t].l,n.gdpr[t].h),i.addGDPRConsentState(t,f));return i}};t.exports={createGDPRConsent:r,Serialization:f,createConsentState:u}},{"./helpers":9}],3:[function(n,t){t.exports={sdkVersion:"2.9.3",sdkVendor:"mparticle",platform:"web",Messages:{ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions"},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function. The onUserAlias provided is of type",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90},DefaultUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},Features:{Batching:"batching"},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1}}},{}],4:[function(n,t){var u=n("./constants"),r=n("./persistence"),f=u.Messages,i={attemptCookieSync:function(n,t){var u,e,o,s,f;t&&!mParticle.Store.webviewBridgeEnabled&&mParticle.preInit.pixelConfigurations.forEach(function(h){u={moduleId:h.moduleId,frequencyCap:h.frequencyCap,pixelUrl:i.replaceAmp(h.pixelUrl),redirectUrl:h.redirectUrl?i.replaceAmp(h.redirectUrl):null};o=i.replaceMPID(u.pixelUrl,t);s=u.redirectUrl?i.replaceMPID(u.redirectUrl,t):"";f=o+encodeURIComponent(s);var c=r.getPersistence();if(n&&n!==t){c&&c[t]&&(c[t].csd||(c[t].csd={}),i.performCookieSync(f,u.moduleId,t,c[t].csd));return}c[t]&&(c[t].csd||(c[t].csd={}),e=c[t].csd[u.moduleId.toString()]?c[t].csd[u.moduleId.toString()]:null,e?(new Date).getTime()>new Date(e).getTime()+u.frequencyCap*864e5&&i.performCookieSync(f,u.moduleId,t,c[t].csd):i.performCookieSync(f,u.moduleId,t,c[t].csd))})},performCookieSync:function(n,t,i,u){var e=document.createElement("img");mParticle.Logger.verbose(f.InformationMessages.CookieSync);e.src=n;u[t.toString()]=(new Date).getTime();r.saveUserCookieSyncDatesToCookies(i,u)},replaceMPID:function(n,t){return n.replace("%%mpid%%",t)},replaceAmp:function(n){return n.replace(/&amp;/g,"&")}};t.exports=i},{"./constants":3,"./persistence":16}],5:[function(n,t){function a(n,t){t.TransactionId=n.Id;t.Affiliation=n.Affiliation;t.CouponCode=n.CouponCode;t.TotalAmount=n.Revenue;t.ShippingAmount=n.Shipping;t.TaxAmount=n.Tax}function v(n){switch(n){case i.ProductActionType.AddToCart:return"AddToCart";case i.ProductActionType.AddToWishlist:return"AddToWishlist";case i.ProductActionType.Checkout:return"Checkout";case i.ProductActionType.CheckoutOption:return"CheckoutOption";case i.ProductActionType.Click:return"Click";case i.ProductActionType.Purchase:return"Purchase";case i.ProductActionType.Refund:return"Refund";case i.ProductActionType.RemoveFromCart:return"RemoveFromCart";case i.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case i.ProductActionType.ViewDetail:return"ViewDetail";case i.ProductActionType.Unknown:default:return"Unknown"}}function y(n){switch(n){case i.PromotionActionType.PromotionClick:return"PromotionClick";case i.PromotionActionType.PromotionView:return"PromotionView";default:return"Unknown"}}function p(n){switch(n){case i.ProductActionType.AddToCart:return i.CommerceEventType.ProductAddToCart;case i.ProductActionType.AddToWishlist:return i.CommerceEventType.ProductAddToWishlist;case i.ProductActionType.Checkout:return i.CommerceEventType.ProductCheckout;case i.ProductActionType.CheckoutOption:return i.CommerceEventType.ProductCheckoutOption;case i.ProductActionType.Click:return i.CommerceEventType.ProductClick;case i.ProductActionType.Purchase:return i.CommerceEventType.ProductPurchase;case i.ProductActionType.Refund:return i.CommerceEventType.ProductRefund;case i.ProductActionType.RemoveFromCart:return i.CommerceEventType.ProductRemoveFromCart;case i.ProductActionType.RemoveFromWishlist:return i.CommerceEventType.ProductRemoveFromWishlist;case i.ProductActionType.Unknown:return i.EventType.Unknown;case i.ProductActionType.ViewDetail:return i.CommerceEventType.ProductViewDetail;default:return mParticle.Logger.error("Could not convert product action type "+n+" to event type"),null}}function w(n){switch(n){case i.PromotionActionType.PromotionClick:return i.CommerceEventType.PromotionClick;case i.PromotionActionType.PromotionView:return i.CommerceEventType.PromotionView;default:return mParticle.Logger.error("Could not convert promotion action type "+n+" to event type"),null}}function f(n,t){return"eCommerce - "+n+" - "+(t?"Total":"Item")}function s(n,t){t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.Brand&&(n.Brand=t.Brand);t.Category&&(n.Category=t.Category);t.Name&&(n.Name=t.Name);t.Sku&&(n.Id=t.Sku);t.Price&&(n["Item Price"]=t.Price);t.Quantity&&(n.Quantity=t.Quantity);t.Position&&(n.Position=t.Position);t.Variant&&(n.Variant=t.Variant);n["Total Product Amount"]=t.TotalAmount||0}function h(n,t){t.TransactionId&&(n["Transaction Id"]=t.TransactionId)}function c(n,t){h(n,t);t.Affiliation&&(n.Affiliation=t.Affiliation);t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.TotalAmount&&(n["Total Amount"]=t.TotalAmount);t.ShippingAmount&&(n["Shipping Amount"]=t.ShippingAmount);t.TaxAmount&&(n["Tax Amount"]=t.TaxAmount);t.CheckoutOptions&&(n["Checkout Options"]=t.CheckoutOptions);t.CheckoutStep&&(n["Checkout Step"]=t.CheckoutStep)}function l(n,t){t.Id&&(n.Id=t.Id);t.Creative&&(n.Creative=t.Creative);t.Name&&(n.Name=t.Name);t.Position&&(n.Position=t.Position)}function b(n,t){return t?Array.isArray(t)?t:[t]:n.ShoppingCart.ProductList}function k(n,t,i,u,f,o,s,h,c,l){return(l=r.sanitizeAttributes(l),typeof n!="string")?(mParticle.Logger.error("Name is required when creating a product"),null):e.isStringOrNumber(t)?e.isStringOrNumber(i)?(u||(u=1),{Name:n,Sku:t,Price:i,Quantity:u,Brand:s,Variant:f,Category:o,Position:h,CouponCode:c,TotalAmount:u*i,Attributes:l}):(mParticle.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(mParticle.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)}function d(n,t,i,r){return e.isStringOrNumber(n)?{Id:n,Creative:t,Name:i,Position:r}:(mParticle.Logger.error(o.ErrorMessages.PromotionIdRequired),null)}function g(n,t){return typeof n!="string"?(mParticle.Logger.error("Name is required when creating an impression."),null):t?{Name:n,Product:t}:(mParticle.Logger.error("Product is required when creating an impression."),null)}function nt(n,t,i,r,u,f){return e.isStringOrNumber(n)?{Id:n,Affiliation:t,CouponCode:i,Revenue:r,Shipping:u,Tax:f}:(mParticle.Logger.error(o.ErrorMessages.TransactionIdRequired),null)}function tt(n){var t=[];return n.ProductImpressions?(n.ProductImpressions.forEach(function(e){e.ProductList&&e.ProductList.forEach(function(o){var h=r.extend(!1,{},n.EventAttributes),c,l;if(o.Attributes)for(c in o.Attributes)h[c]=o.Attributes[c];s(h,o);e.ProductImpressionList&&(h["Product Impression List"]=e.ProductImpressionList);l=u.createEventObject(i.MessageType.PageEvent,f("Impression"),h,i.EventType.Transaction);t.push(l)})}),t):t}function it(n){return n?ut(n).concat(rt(n)).concat(tt(n)):null}function rt(n){var t=[],e;return n.PromotionAction?(e=n.PromotionAction.PromotionList,e.forEach(function(e){var o=r.extend(!1,{},n.EventAttributes),s;l(o,e);s=u.createEventObject(i.MessageType.PageEvent,f(i.PromotionActionType.getExpansionName(n.PromotionAction.PromotionActionType)),o,i.EventType.Transaction);t.push(s)}),t):t}function ut(n){var t=[],o,e,a,l;return n.ProductAction?(o=!1,n.ProductAction.ProductActionType===i.ProductActionType.Purchase||n.ProductAction.ProductActionType===i.ProductActionType.Refund?(e=r.extend(!1,{},n.EventAttributes),e["Product Count"]=n.ProductAction.ProductList?n.ProductAction.ProductList.length:0,c(e,n.ProductAction),n.CurrencyCode&&(e["Currency Code"]=n.CurrencyCode),a=u.createEventObject(i.MessageType.PageEvent,f(i.ProductActionType.getExpansionName(n.ProductAction.ProductActionType),!0),e,i.EventType.Transaction),t.push(a)):o=!0,l=n.ProductAction.ProductList,!l)?t:(l.forEach(function(e){var l=r.extend(!1,n.EventAttributes,e.Attributes),a;o?c(l,n.ProductAction):h(l,n.ProductAction);s(l,e);a=u.createEventObject(i.MessageType.PageEvent,f(i.ProductActionType.getExpansionName(n.ProductAction.ProductActionType)),l,i.EventType.Transaction);t.push(a)}),t):t}function ft(n){var t,f=mParticle.Identity.getCurrentUser();return(mParticle.Logger.verbose(o.InformationMessages.StartingLogCommerceEvent),r.canLog())?(t=u.createEventObject(i.MessageType.Commerce),t.EventName="eCommerce - ",t.CurrencyCode=mParticle.Store.currencyCode,t.ShoppingCart={ProductList:f?f.getCart().getCartProducts():[]},t.CustomFlags=n,t):(mParticle.Logger.verbose(o.InformationMessages.AbandonLogEvent),null)}var i=n("./types"),r=n("./helpers"),e=r.Validators,o=n("./constants").Messages,u=n("./serverModel");t.exports={convertTransactionAttributesToProductAction:a,getProductActionEventName:v,getPromotionActionEventName:y,convertProductActionToEventType:p,convertPromotionActionToEventType:w,generateExpandedEcommerceName:f,extractProductAttributes:s,extractActionAttributes:c,extractPromotionAttributes:l,extractTransactionId:h,buildProductList:b,createProduct:k,createPromotion:d,createImpression:g,createTransactionAttributes:nt,expandCommerceEvent:it,createCommerceEventObject:ft}},{"./constants":3,"./helpers":9,"./serverModel":18,"./types":21}],6:[function(n,t){function l(n,t,i,r,u){mParticle.Logger.verbose(f.InformationMessages.StartingLogEvent+": "+t);o.canLog()?(a(),i&&(i=o.sanitizeAttributes(i)),h(v.createEventObject(n,t,i,r,u),c,s),e.update()):mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent)}function s(n){var u=new Date,t,i,r;if(n)try{if(mParticle.Logger.verbose("Parsing response from server"),t=JSON.parse(n),t&&t.Store){mParticle.Logger.verbose("Parsed store from response, updating local settings");mParticle.Store.serverSettings||(mParticle.Store.serverSettings={});for(i in t.Store)t.Store.hasOwnProperty(i)&&(r=t.Store[i],!r.Value||new Date(r.Expires)<u?mParticle.Store.serverSettings.hasOwnProperty(i)&&delete mParticle.Store.serverSettings[i]:mParticle.Store.serverSettings[i]=r);e.update()}}catch(f){mParticle.Logger.error("Error parsing JSON response from server: "+f.name)}}function w(n){function r(i){mParticle.Store.currentPosition={lat:i.coords.latitude,lng:i.coords.longitude};t(n,i);n=null;mParticle.Store.isTracking=!0}function u(){t(n);n=null;mParticle.Store.isTracking=!1}function t(n,t){if(n)try{t?n(t):n()}catch(i){mParticle.Logger.error("Error invoking the callback passed to startTrackingLocation.");mParticle.Logger.error(i)}}if(mParticle.Store.isTracking){var i={coords:{latitude:mParticle.Store.currentPosition.lat,longitude:mParticle.Store.currentPosition.lng}};t(n,i)}else"geolocation"in navigator&&(mParticle.Store.watchPositionId=navigator.geolocation.watchPosition(r,u))}function b(){mParticle.Store.isTracking&&(navigator.geolocation.clearWatch(mParticle.Store.watchPositionId),mParticle.Store.currentPosition=null,mParticle.Store.isTracking=!1)}function k(){mParticle.Logger.verbose(f.InformationMessages.StartingLogOptOut);h(v.createEventObject(r.MessageType.OptOut,null,null,r.EventType.Other),c,s)}function d(){l(r.MessageType.AppStateTransition)}function g(n,t,f,e){var o=i.createCommerceEventObject(e);o&&(o.EventName+=i.getProductActionEventName(r.ProductActionType.Checkout),o.EventCategory=r.CommerceEventType.ProductCheckout,o.ProductAction={ProductActionType:r.ProductActionType.Checkout,CheckoutStep:n,CheckoutOptions:t,ProductList:o.ShoppingCart.ProductList},u(o,f))}function nt(n,t,r,f){var e=i.createCommerceEventObject(f);e&&(e.EventCategory=i.convertProductActionToEventType(n),e.EventName+=i.getProductActionEventName(n),e.ProductAction={ProductActionType:n,ProductList:Array.isArray(t)?t:[t]},u(e,r))}function tt(n,t,f,e){var o=i.createCommerceEventObject(e);o&&(o.EventName+=i.getProductActionEventName(r.ProductActionType.Purchase),o.EventCategory=r.CommerceEventType.ProductPurchase,o.ProductAction={ProductActionType:r.ProductActionType.Purchase},o.ProductAction.ProductList=i.buildProductList(o,t),i.convertTransactionAttributesToProductAction(n,o.ProductAction),u(o,f))}function it(n,t,e,o){if(!n){mParticle.Logger.error(f.ErrorMessages.TransactionRequired);return}var s=i.createCommerceEventObject(o);s&&(s.EventName+=i.getProductActionEventName(r.ProductActionType.Refund),s.EventCategory=r.CommerceEventType.ProductRefund,s.ProductAction={ProductActionType:r.ProductActionType.Refund},s.ProductAction.ProductList=i.buildProductList(s,t),i.convertTransactionAttributesToProductAction(n,s.ProductAction),u(s,e))}function rt(n,t,r,f){var e=i.createCommerceEventObject(f);e&&(e.EventName+=i.getPromotionActionEventName(n),e.EventCategory=i.convertPromotionActionToEventType(n),e.PromotionAction={PromotionActionType:n,PromotionList:[t]},u(e,r))}function ut(n,t,f){var e=i.createCommerceEventObject(f);e&&(e.EventName+="Impression",e.EventCategory=r.CommerceEventType.ProductImpression,Array.isArray(n)||(n=[n]),e.ProductImpressions=[],n.forEach(function(n){e.ProductImpressions.push({ProductImpressionList:n.Name,ProductList:Array.isArray(n.Product)?n.Product:[n.Product]})}),u(e,t))}function u(n,t){mParticle.Logger.verbose(f.InformationMessages.StartingLogCommerceEvent);t=o.sanitizeAttributes(t);o.canLog()?(a(),mParticle.Store.webviewBridgeEnabled&&(n.ShoppingCart={}),t&&(n.EventAttributes=t),h(n,c,s),e.update()):mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent)}function ft(n,t,i,u,f){var o=[],h=function(n){var t=function(){e.href?window.location.href=e.href:e.submit&&e.submit()};mParticle.Logger.verbose("DOM event triggered, handling event");l(r.MessageType.PageEvent,typeof i=="function"?i(e):i,typeof u=="function"?u(e):u,f||r.EventType.Other);(e.href&&e.target!=="_blank"||e.submit)&&(n.preventDefault?n.preventDefault():n.returnValue=!1,setTimeout(t,mParticle.Store.SDKConfig.timeout))},e,s;if(!t){mParticle.Logger.error("Can't bind event, selector is required");return}if(typeof t=="string"?o=document.querySelectorAll(t):t.nodeType&&(o=[t]),o.length)for(mParticle.Logger.verbose("Found "+o.length+" element"+(o.length>1?"s":"")+", attaching event handlers"),s=0;s<o.length;s++)e=o[s],e.addEventListener?e.addEventListener(n,h,!1):e.attachEvent?e.attachEvent("on"+n,h):e["on"+n]=h;else mParticle.Logger.verbose("No elements found")}function a(){if(!mParticle.Store.webviewBridgeEnabled){var n=e.getCookie()||e.getLocalStorage();!mParticle.Store.sessionId&&n&&(n.sid?mParticle.Store.sessionId=n.sid:p.startNewSession())}}var r=n("./types"),y=n("./constants"),o=n("./helpers"),i=n("./ecommerce"),v=n("./serverModel"),p=n("./sessionManager"),e=n("./persistence"),f=y.Messages,h=n("./apiClient").sendEventToServer,c=n("./forwarders").sendEventToForwarders;t.exports={logEvent:l,startTracking:w,stopTracking:b,logCheckoutEvent:g,logProductActionEvent:nt,logPurchaseEvent:tt,logRefundEvent:it,logPromotionEvent:rt,logImpressionEvent:ut,logOptOut:k,logAST:d,parseEventResponse:s,logCommerceEvent:u,addEventHandler:ft,startNewSessionIfNeeded:a}},{"./apiClient":1,"./constants":3,"./ecommerce":5,"./forwarders":7,"./helpers":9,"./persistence":16,"./serverModel":18,"./sessionManager":19,"./types":21}],7:[function(n,t){function v(n){var t=mParticle.Identity.getCurrentUser();!mParticle.Store.webviewBridgeEnabled&&mParticle.preInit.configuredForwarders&&(mParticle.preInit.configuredForwarders.sort(function(n,t){return n.settings.PriorityValue=n.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(n.settings.PriorityValue-t.settings.PriorityValue)}),mParticle.Store.activeForwarders=mParticle.preInit.configuredForwarders.filter(function(r){if(!e(r.filteringConsentRuleValues,t)||!o(r.filteringUserAttributeValue,t)||!y(r.excludeAnonymousUser,t))return!1;var u=i.filterUserIdentities(n,r.userIdentityFilters),f=i.filterUserAttributes(t?t.getAllUserAttributes():{},r.userAttributeFilters);return r.initialized||(r.init(r.settings,s,!1,null,f,u,mParticle.Store.SDKConfig.appVersion,mParticle.Store.SDKConfig.appName,mParticle.Store.SDKConfig.customFlags,mParticle.Store.clientId),r.initialized=!0),!0}))}function e(n,t){var r,u,s,f;if(!n||!n.values||!n.values.length)return!0;if(!t)return!1;var e={},o=t.getConsentState();if(o&&(r=o.getGDPRConsentState(),r))for(u in r)r.hasOwnProperty(u)&&(s=i.generateHash("1"+u).toString(),e[s]=r[u].Consented);return f=!1,n.values.forEach(function(n){if(!f){var t=n.consentPurpose,i=n.hasConsented;e.hasOwnProperty(t)&&e[t]===i&&(f=!0)}}),n.includeOnMatch===f}function o(n,t){var e,o,r,f,u;if(!n||!i.isObject(n)||!Object.keys(n).length)return!0;if(t)r=t.getAllUserAttributes();else return!1;f=!1;try{if(r&&i.isObject(r)&&Object.keys(r).length)for(u in r)if(r.hasOwnProperty(u)&&(e=i.generateHash(u).toString(),o=i.generateHash(r[u]).toString(),e===n.userAttributeName&&o===n.userAttributeValue)){f=!0;break}return n?n.includeOnMatch===f:!0}catch(s){return!0}}function y(n,t){return(!t||!t.isLoggedIn())&&n?!1:!0}function p(n,t){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(i){var u=i[n],r;if(u)try{r=i[n](t);r&&mParticle.Logger.verbose(r)}catch(f){mParticle.Logger.verbose(f)}})}function w(n){var u,o,s,p=function(n,t){n.UserIdentities&&n.UserIdentities.length&&n.UserIdentities.forEach(function(r,u){i.inArray(t,r.Type)&&(n.UserIdentities.splice(u,1),u>0&&u--)})},v=function(n,t){var u,r;if(t)for(r in n.EventAttributes)n.EventAttributes.hasOwnProperty(r)&&(u=i.generateHash(n.EventCategory+n.EventName+r),i.inArray(t,u)&&delete n.EventAttributes[r])},f=function(n,t){return n&&n.length&&i.inArray(n,t)?!0:!1},w=[r.MessageType.PageEvent,r.MessageType.PageView,r.MessageType.Commerce],t,e,h,c,l,y,a;if(!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.activeForwarders)for(o=i.generateHash(n.EventCategory+n.EventName),s=i.generateHash(n.EventCategory),t=0;t<mParticle.Store.activeForwarders.length;t++){if(w.indexOf(n.EventDataType)>-1&&mParticle.Store.activeForwarders[t].filteringEventAttributeValue&&mParticle.Store.activeForwarders[t].filteringEventAttributeValue.eventAttributeName&&mParticle.Store.activeForwarders[t].filteringEventAttributeValue.eventAttributeValue){if(e=null,n.EventAttributes)for(h in n.EventAttributes){c=i.generateHash(h).toString();c===mParticle.Store.activeForwarders[t].filteringEventAttributeValue.eventAttributeName&&(e={name:c,value:i.generateHash(n.EventAttributes[h]).toString()});break}if(l=e!==null&&e.value===mParticle.Store.activeForwarders[t].filteringEventAttributeValue.eventAttributeValue,y=mParticle.Store.activeForwarders[t].filteringEventAttributeValue.includeOnMatch===!0?l:!l,!y)continue}if(u={},u=i.extend(!0,u,n),n.EventDataType===r.MessageType.PageEvent&&(f(mParticle.Store.activeForwarders[t].eventNameFilters,o)||f(mParticle.Store.activeForwarders[t].eventTypeFilters,s)))continue;else if(n.EventDataType===r.MessageType.Commerce&&f(mParticle.Store.activeForwarders[t].eventTypeFilters,s))continue;else if(n.EventDataType===r.MessageType.PageView&&f(mParticle.Store.activeForwarders[t].screenNameFilters,o))continue;u.EventAttributes&&(n.EventDataType===r.MessageType.PageEvent?v(u,mParticle.Store.activeForwarders[t].attributeFilters):n.EventDataType===r.MessageType.PageView&&v(u,mParticle.Store.activeForwarders[t].pageViewAttributeFilters));p(u,mParticle.Store.activeForwarders[t].userIdentityFilters);u.UserAttributes=i.filterUserAttributes(u.UserAttributes,mParticle.Store.activeForwarders[t].userAttributeFilters);mParticle.Logger.verbose("Sending message to forwarder: "+mParticle.Store.activeForwarders[t].name);mParticle.Store.activeForwarders[t].process&&(a=mParticle.Store.activeForwarders[t].process(u),a&&mParticle.Logger.verbose(a))}}function b(n,t){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(r){if(r.setUserAttribute&&r.userAttributeFilters&&!i.inArray(r.userAttributeFilters,i.generateHash(n)))try{var u=r.setUserAttribute(n,t);u&&mParticle.Logger.verbose(u)}catch(f){mParticle.Logger.error(f)}})}function k(n){mParticle.Store.activeForwarders.forEach(function(t){var r=i.filterUserIdentities(n,t.userIdentityFilters);t.setUserIdentity&&r.forEach(function(n){var i=t.setUserIdentity(n.Identity,n.Type);i&&mParticle.Logger.verbose(i)})})}function d(n){mParticle.Store.activeForwarders.forEach(function(t){var r=u.getFilteredMparticleUser(n.getMPID(),t),i;t.onUserIdentified&&(i=t.onUserIdentified(r),i&&mParticle.Logger.verbose(i))})}function g(n,t){var i;mParticle.Store.activeForwarders.forEach(function(r){var f=u.getFilteredMparticleUser(n.getMPID(),r);t==="identify"?r.onIdentifyComplete&&(i=r.onIdentifyComplete(f),i&&mParticle.Logger.verbose(i)):t==="login"?r.onLoginComplete&&(i=r.onLoginComplete(f),i&&mParticle.Logger.verbose(i)):t==="logout"?r.onLogoutComplete&&(i=r.onLogoutComplete(f),i&&mParticle.Logger.verbose(i)):t==="modify"&&r.onModifyComplete&&(i=r.onModifyComplete(f),i&&mParticle.Logger.verbose(i))})}function s(n,t){var r,u=h();n&&n.isVisible&&(r={mid:n.id,esid:n.eventSubscriptionId,n:t.EventName,attrs:t.EventAttributes,sdk:t.SDKVersion,dt:t.EventDataType,et:t.EventCategory,dbg:t.Debug,ct:t.Timestamp,eec:t.ExpandedEventCount},i.hasFeatureFlag(l.Features.Batching)?(u.push(r),c(u)):a.sendSingleForwardingStatsToServer(r))}function h(){return f.forwardingStatsBatches.forwardingStatsEventQueue}function c(n){f.forwardingStatsBatches.forwardingStatsEventQueue=n}var i=n("./helpers"),r=n("./types"),l=n("./constants"),u=n("./mParticleUser"),a=n("./apiClient"),f=n("./persistence");t.exports={initForwarders:v,applyToForwarders:p,sendEventToForwarders:w,callSetUserAttributeOnForwarders:b,setForwarderUserIdentities:k,setForwarderOnUserIdentified:d,setForwarderOnIdentityComplete:g,prepareForwardingStats:s,getForwarderStatsQueue:h,setForwarderStatsQueue:c,isEnabledForUserConsent:e,isEnabledForUserAttributes:o}},{"./apiClient":1,"./constants":3,"./helpers":9,"./mParticleUser":12,"./persistence":16,"./types":21}],8:[function(n,t){function e(){mParticle._forwardingStatsTimer=setInterval(function(){o()},mParticle.Store.SDKConfig.forwarderStatsTimeout)}function o(){var t=i.getForwarderStatsQueue(),n=f.forwardingStatsBatches.uploadsTable,o=Date.now(),e;t.length&&(n[o]={uploading:!1,data:t},i.setForwarderStatsQueue([]));for(e in n)(function(t){if(n.hasOwnProperty(t)&&n[t].uploading===!1){var f=function(){i.readyState===4&&(i.status===200||i.status===202?(mParticle.Logger.verbose("Successfully sent  "+i.statusText+" from server"),delete n[t]):i.status.toString()[0]==="4"?i.status!==429&&delete n[t]:n[t].uploading=!1)},i=u.createXHR(f),e=n[t].data;n[t].uploading=!0;r.sendBatchForwardingStatsToServer(e,i)}})(e)}var r=n("./apiClient"),u=n("./helpers"),i=n("./forwarders"),f=n("./persistence");t.exports={startForwardingStatsTimer:e}},{"./apiClient":1,"./forwarders":7,"./helpers":9,"./persistence":16}],9:[function(n,t){function a(){return mParticle.Store.isEnabled&&(mParticle.Store.devToken||mParticle.Store.webviewBridgeEnabled)?!0:!1}function v(n){return n==="false"||n==="0"?!1:Boolean(n)}function y(n){if(mParticle.preInit.featureFlags)return mParticle.preInit.featureFlags[n]}function p(n,t,i,r,u){n||mParticle.Logger.warning("There is no callback provided");try{f.isFunction(n)&&n({httpCode:t,body:i,getUser:function(){return r?r:mParticle.Identity.getCurrentUser()},getPreviousUser:function(){if(u)return mParticle.Identity.getUser(u);var t=mParticle.Identity.getUsers(),n=t.shift(),i=r||mParticle.Identity.getCurrentUser();return n&&i&&n.getMPID()===i.getMPID()&&(n=t.shift()),n||null}})}catch(e){mParticle.Logger.error("There was an error with your callback: "+e)}}function w(n,t,i){n||mParticle.Logger.warning("There is no callback provided");try{if(f.isFunction(n)){var r={httpCode:t};i&&(r.message=i);n(r)}}catch(u){mParticle.Logger.error("There was an error with your callback: "+u)}}function s(){var e,f,r,i,o,h,t=arguments[0]||{},u=1,l=arguments.length,c=!1,n={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(t){return t==null?String(t):n.class2type[Object.prototype.toString.call(t)]||"object"},isPlainObject:function(t){if(!t||n.type(t)!=="object"||t.nodeType||n.isWindow(t))return!1;try{if(t.constructor&&!n.hasOwn.call(t,"constructor")&&!n.hasOwn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(var i in t);return i===undefined||n.hasOwn.call(t,i)},isArray:Array.isArray||function(t){return n.type(t)==="array"},isFunction:function(t){return n.type(t)==="function"},isWindow:function(n){return n!=null&&n==n.window}};for(typeof t=="boolean"&&(c=t,t=arguments[1]||{},u=2),typeof t=="object"||n.isFunction(t)||(t={}),l===u&&(t=this,--u);u<l;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(c&&i&&(n.isPlainObject(i)||(o=n.isArray(i)))?(o?(o=!1,h=r&&n.isArray(r)?r:[]):h=r&&n.isPlainObject(r)?r:{},t[f]=s(c,h,i)):i!==undefined&&(t[f]=i));return t}function i(n){var t=Object.prototype.toString.call(n);return t==="[object Object]"||t==="[object Error]"}function o(n,t){var i=0,r;if(Array.prototype.indexOf)return n.indexOf(t,0)>=0;for(r=n.length;i<r;i++)if(i in n&&n[i]===t)return!0}function b(n,t){var r=window.mParticle&&mParticle.Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//",i;return i=mParticle.Store.SDKConfig.forceHttps?"https://"+n:r+n,t&&(i=i+t),i}function k(n){var t;try{t=new window.XMLHttpRequest}catch(i){mParticle.Logger.error("Error creating XMLHttpRequest object.")}if(t&&n&&"withCredentials"in t)t.onreadystatechange=n;else if(typeof XDomainRequest!="undefined"){mParticle.Logger.verbose("Creating XDomainRequest object");try{t=new window.XDomainRequest;t.onload=n}catch(i){mParticle.Logger.error("Error creating XDomainRequest object")}}return t}function d(n){var t;return(window.crypto&&window.crypto.getRandomValues&&(t=window.crypto.getRandomValues(new Uint8Array(1))),t)?(n^t[0]%16>>n/4).toString(16):(n^Math.random()*16>>n/4).toString(16)}function h(n){return n?d(n):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,h)}function g(n,t){var f=[],i,r,e;if(n&&Object.keys(n).length)for(i in n)n.hasOwnProperty(i)&&(r=u.IdentityType.getIdentityType(i),o(t,r)||(e={Type:r,Identity:n[i]},r===mParticle.IdentityType.CustomerId?f.unshift(e):f.push(e)));return f}function nt(n,t){var r={},i,f;if(n&&Object.keys(n).length)for(i in n)n.hasOwnProperty(i)&&(f=u.IdentityType.getIdentityType(i),o(t,f)||(r[i]=n[i]));return r}function tt(n,t){var r={},i,u;if(n&&Object.keys(n).length)for(i in n)n.hasOwnProperty(i)&&(u=c(i),o(t,u)||(r[i]=n[i]));return r}function it(n,t){if(t&&n)for(var i in n)if(n.hasOwnProperty(i)&&i.toLowerCase()===t.toLowerCase())return i;return null}function rt(n){return decodeURIComponent(n.replace(l," "))}function ut(n){return n.indexOf('"')===0&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),n}function ft(n){for(var t in u.EventType)if(u.EventType.hasOwnProperty(t)&&u.EventType[t]===n)return!0;return!1}function et(n){if(isNaN(n)||!isFinite(n))return 0;var t=parseFloat(n);return isNaN(t)?0:t}function ot(n){return f.isStringOrNumber(n)?n:null}function c(n){var t=0,i=0,r;if(n===undefined||n===null)return 0;if(n=n.toString().toLowerCase(),Array.prototype.reduce)return n.split("").reduce(function(n,t){return n=(n<<5)-n+t.charCodeAt(0),n&n},0);if(n.length===0)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return t}function st(n){var r,t;if(!n||!i(n))return null;r={};for(t in n)n.hasOwnProperty(t)&&f.isValidAttributeValue(n[t])?r[t]=n[t]:mParticle.Logger.warning("The corresponding attribute value of "+t+" must be a string, number, boolean, or null.");return r}function ht(){var t=Array.prototype.slice.call(arguments),n={};return t.forEach(function(t){if(i(t))for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}),n}function ct(n,t,i){if(i-t>mParticle.Store.SDKConfig.integrationDelayTimeout)return!1;for(var r in n){if(n[r]===!0)return!0;continue}return!1}function lt(n,t,i,r,u,f){if(n.length&&t&&i){var e=n;mParticle.Store.eventQueue=[];e.forEach(function(n){n.MPID=t;r(n,u,f)})}}function at(n){return n?e.currentStorageName+"_"+n:e.currentStorageName}function vt(n){return n?e.currentStorageProductsName+"_"+n:e.currentStorageProductsName}var u=n("./types"),r=n("./constants"),e=r.StorageNames,l=/\+/g,f={isValidAttributeValue:function(n){return n!==undefined&&!i(n)&&!Array.isArray(n)},isValidKeyValue:function(n){return Boolean(n&&!i(n)&&!Array.isArray(n))},isStringOrNumber:function(n){return typeof n=="string"||typeof n=="number"},isFunction:function(n){return typeof n=="function"},validateIdentities:function(n,t){var s={userIdentities:1,onUserAlias:1,copyUserAttributes:1},e,o;if(n){if(t==="modify"&&(i(n.userIdentities)&&!Object.keys(n.userIdentities).length||!i(n.userIdentities)))return{valid:!1,error:r.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(e in n)if(n.hasOwnProperty(e)){if(!s[e])return{valid:!1,error:r.Messages.ValidationMessages.IdentityRequesetInvalidKey};if(e==="onUserAlias"&&!f.isFunction(n[e]))return{valid:!1,error:r.Messages.ValidationMessages.OnUserAliasType+typeof n[e]}}if(Object.keys(n).length===0)return{valid:!0};if(n.userIdentities===undefined)return{valid:!1,error:r.Messages.ValidationMessages.UserIdentities};if(n.userIdentities!==null&&!i(n.userIdentities))return{valid:!1,error:r.Messages.ValidationMessages.UserIdentities};if(i(n.userIdentities)&&Object.keys(n.userIdentities).length)for(o in n.userIdentities)if(n.userIdentities.hasOwnProperty(o)){if(u.IdentityType.getIdentityType(o)===!1)return{valid:!1,error:r.Messages.ValidationMessages.UserIdentitiesInvalidKey};if(!(typeof n.userIdentities[o]=="string"||n.userIdentities[o]===null))return{valid:!1,error:r.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}};t.exports={canLog:a,extend:s,isObject:i,inArray:o,createServiceUrl:b,createXHR:k,generateUniqueId:h,filterUserIdentities:g,filterUserIdentitiesForForwarders:nt,filterUserAttributes:tt,findKeyInObject:it,decoded:rt,converted:ut,isEventType:ft,parseNumber:et,parseStringOrNumber:ot,generateHash:c,sanitizeAttributes:st,mergeConfigs:ht,returnConvertedBoolean:v,invokeCallback:p,invokeAliasCallback:w,hasFeatureFlag:y,isDelayedByIntegration:ct,processQueuedEvents:lt,createMainStorageName:at,createProductStorageName:vt,Validators:f}},{"./constants":3,"./types":21}],10:[function(n,t){function v(n,t){return{getUserIdentities:function(){var f={},t=i.getUserIdentities(n);for(var u in t)t.hasOwnProperty(u)&&(f[c.IdentityType.getIdentityName(r.parseNumber(u))]=t[u]);return{userIdentities:f}},getMPID:function(){return n},setUserTag:function(n){if(!l.isValidKeyValue(n)){mParticle.Logger.error(f.ErrorMessages.BadKey);return}this.setUserAttribute(n,null)},removeUserTag:function(n){if(!l.isValidKeyValue(n)){mParticle.Logger.error(f.ErrorMessages.BadKey);return}this.removeUserAttribute(n)},setUserAttribute:function(t,e){var o,c,v;if(mParticle.sessionManager.resetSessionTimer(),r.canLog()){if(!l.isValidAttributeValue(e)){mParticle.Logger.error(f.ErrorMessages.BadAttribute);return}if(!l.isValidKeyValue(t)){mParticle.Logger.error(f.ErrorMessages.BadKey);return}mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:t,value:e})):(o=i.getPersistence(),c=this.getAllUserAttributes(),v=r.findKeyInObject(c,t),v&&delete c[v],c[t]=e,o&&o[n]&&(o[n].ua=c,i.saveCookies(o,n)),s.initForwarders(a.getCurrentUser().getUserIdentities()),s.callSetUserAttributeOnForwarders(t,e))}},setUserAttributes:function(n){if(mParticle.sessionManager.resetSessionTimer(),r.isObject(n)){if(r.canLog())for(var t in n)n.hasOwnProperty(t)&&this.setUserAttribute(t,n[t])}else mParticle.Logger.error("Must pass an object into setUserAttributes. You passed a "+typeof n)},removeUserAttribute:function(t){var e,o,c;if(mParticle.sessionManager.resetSessionTimer(),!l.isValidKeyValue(t)){mParticle.Logger.error(f.ErrorMessages.BadKey);return}mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:t,value:null})):(e=i.getPersistence(),o=this.getAllUserAttributes(),c=r.findKeyInObject(o,t),c&&(t=c),delete o[t],e&&e[n]&&(e[n].ua=o,i.saveCookies(e,n)),s.initForwarders(a.getCurrentUser().getUserIdentities()),s.applyToForwarders("removeUserAttribute",t))},setUserAttributeList:function(t,e){var o,c,v,y;if(mParticle.sessionManager.resetSessionTimer(),!l.isValidKeyValue(t)){mParticle.Logger.error(f.ErrorMessages.BadKey);return}if(!Array.isArray(e)){mParticle.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+typeof e);return}v=e.slice();mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:t,value:v})):(o=i.getPersistence(),c=this.getAllUserAttributes(),y=r.findKeyInObject(c,t),y&&delete c[y],c[t]=v,o&&o[n]&&(o[n].ua=c,i.saveCookies(o,n)),s.initForwarders(a.getCurrentUser().getUserIdentities()),s.callSetUserAttributeOnForwarders(t,v))},removeAllUserAttributes:function(){var t,r,f;if(mParticle.sessionManager.resetSessionTimer(),mParticle.Store.webviewBridgeEnabled)h.sendToNative(u.NativeSdkPaths.RemoveAllUserAttributes);else{if(t=i.getPersistence(),r=this.getAllUserAttributes(),s.initForwarders(a.getCurrentUser().getUserIdentities()),r)for(f in r)r.hasOwnProperty(f)&&s.applyToForwarders("removeUserAttribute",f);t&&t[n]&&(t[n].ua={},i.saveCookies(t,n))}},getUserAttributesLists:function(){var n,i={},t;n=this.getAllUserAttributes();for(t in n)n.hasOwnProperty(t)&&Array.isArray(n[t])&&(i[t]=n[t].slice());return i},getAllUserAttributes:function(){var u={},t=i.getAllUserAttributes(n),r;if(t)for(r in t)t.hasOwnProperty(r)&&(u[r]=Array.isArray(t[r])?t[r].slice():t[r]);return u},getCart:function(){return k(n)},getConsentState:function(){return i.getConsentState(n)},setConsentState:function(t){i.saveUserConsentStateToCookies(n,t);s.initForwarders(this.getUserIdentities().userIdentities)},isLoggedIn:function(){return t},getLastSeenTime:function(){return i.getLastSeenTime(n)},getFirstSeenTime:function(){return i.getFirstSeenTime(n)}}}function k(n){return{add:function(t,f){var s,e,o,l;o=Array.isArray(t)?t.slice():[t];o.forEach(function(n){n.Attributes=r.sanitizeAttributes(n.Attributes)});mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.AddToCart,JSON.stringify(o)):(mParticle.sessionManager.resetSessionTimer(),e=i.getUserProductsFromLS(n),e=e.concat(o),f===!0&&w.logProductActionEvent(c.ProductActionType.AddToCart,o),l={},l[n]={cp:e},e.length>mParticle.Store.SDKConfig.maxProducts&&(mParticle.Logger.verbose("The cart contains "+e.length+" items. Only "+mParticle.Store.SDKConfig.maxProducts+" can currently be saved in cookies."),e=e.slice(-mParticle.Store.SDKConfig.maxProducts)),s=i.getAllUserProductsFromLS(),s[n].cp=e,i.setCartProducts(s))},remove:function(t,r){var e,f,o=-1,s=null,l;mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.RemoveFromCart,JSON.stringify(t)):(mParticle.sessionManager.resetSessionTimer(),f=i.getUserProductsFromLS(n),f&&(f.forEach(function(n,i){n.Sku===t.Sku&&(o=i,s=n)}),o>-1&&(f.splice(o,1),r===!0&&w.logProductActionEvent(c.ProductActionType.RemoveFromCart,s))),l={},l[n]={cp:f},e=i.getAllUserProductsFromLS(),e[n].cp=f,i.setCartProducts(e))},clear:function(){var t;mParticle.Store.webviewBridgeEnabled?h.sendToNative(u.NativeSdkPaths.ClearCart):(mParticle.sessionManager.resetSessionTimer(),t=i.getAllUserProductsFromLS(),t&&t[n]&&t[n].cp&&(t[n].cp=[],t[n].cp=[],i.setCartProducts(t)))},getCartProducts:function(){return i.getCartProducts(n)}}}function p(n,t,u,f,o){var l=mParticle.Identity.getCurrentUser(),v,h,p,k={},it=l?l.getUserIdentities().userIdentities:{},d,y,rt,ft;for(d in it)k[c.IdentityType.getIdentityType(d)]=it[d];y={};mParticle.Store.identityCallInFlight=!1;try{if(mParticle.Logger.verbose("Parsing identity response from server"),n.responseText&&(h=JSON.parse(n.responseText),h.hasOwnProperty("is_logged_in")&&(mParticle.Store.isLoggedIn=h.is_logged_in)),n.status===200){if(o==="modify"?(y=e.modifyUserIdentities(k,f.userIdentities),i.saveUserIdentitiesToCookies(l.getMPID(),y)):(h=JSON.parse(n.responseText),mParticle.Logger.verbose("Successfully parsed Identity Response"),(!l||l.getMPID()&&h.mpid&&h.mpid!==l.getMPID())&&(mParticle.Store.mpid=h.mpid,l&&i.setLastSeenTime(t),i.setFirstSeenTime(h.mpid)),o==="identify"&&l&&h.mpid===l.getMPID()&&i.setFirstSeenTime(h.mpid),p=mParticle.Store.currentSessionMPIDs.indexOf(h.mpid),mParticle.Store.sessionId&&h.mpid&&t!==h.mpid&&p<0&&mParticle.Store.currentSessionMPIDs.push(h.mpid),p>-1&&(mParticle.Store.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs.slice(0,p).concat(mParticle.Store.currentSessionMPIDs.slice(p+1,mParticle.Store.currentSessionMPIDs.length)),mParticle.Store.currentSessionMPIDs.push(h.mpid)),i.saveUserIdentitiesToCookies(h.mpid,y),g.attemptCookieSync(t,h.mpid),b.checkIdentitySwap(t,h.mpid,mParticle.Store.currentSessionMPIDs),r.processQueuedEvents(mParticle.Store.eventQueue,h.mpid,!mParticle.Store.requireDelay,nt,tt,w.parseEventResponse),Object.keys(mParticle.Store.migrationData).length?(y=mParticle.Store.migrationData.userIdentities||{},rt=mParticle.Store.migrationData.userAttributes||{},i.saveUserAttributesToCookies(h.mpid,rt)):f&&f.userIdentities&&Object.keys(f.userIdentities).length&&(y=e.modifyUserIdentities(k,f.userIdentities)),i.saveUserIdentitiesToCookies(h.mpid,y),i.update(),i.findPrevCookiesBasedOnUI(f),mParticle.Store.context=h.context||mParticle.Store.context),v=a.getCurrentUser(),f&&f.onUserAlias&&r.Validators.isFunction(f.onUserAlias))try{mParticle.Logger.warning("Deprecated function onUserAlias will be removed in future releases");f.onUserAlias(l,v)}catch(ut){mParticle.Logger.error("There was an error with your onUserAlias function - "+ut)}ft=i.getCookie()||i.getLocalStorage();v&&(i.storeDataInMemory(ft,v.getMPID()),l&&v.getMPID()===l.getMPID()&&l.isLoggedIn()===v.isLoggedIn()||s.initForwarders(v.getUserIdentities().userIdentities),s.setForwarderUserIdentities(v.getUserIdentities().userIdentities),s.setForwarderOnIdentityComplete(v,o),s.setForwarderOnUserIdentified(v,o))}u?r.invokeCallback(u,n.status,h||null,v):h&&h.errors&&h.errors.length&&mParticle.Logger.error("Received HTTP response code of "+n.status+" - "+h.errors[0].message)}catch(ut){u&&r.invokeCallback(u,n.status,h||null);mParticle.Logger.error("Error parsing JSON response from Identity server: "+ut)}}var r=n("./helpers"),u=n("./constants"),d=n("./serverModel"),s=n("./forwarders"),i=n("./persistence"),c=n("./types"),f=u.Messages,h=n("./nativeSdkHelpers"),l=r.Validators,y=n("./apiClient").sendIdentityRequest,g=n("./cookieSyncManager"),nt=n("./apiClient").sendEventToServer,o=u.HTTPCodes,w=n("./events"),tt=n("./forwarders").sendEventToForwarders,it=n("./apiClient").sendAliasRequest,b={checkIdentitySwap:function(n,t,r){if(n&&t&&n!==t){var u=i.useLocalStorage()?i.getLocalStorage():i.getCookie();u.cu=t;u.gs.csm=r;i.saveCookies(u)}}},e={createKnownIdentities:function(n,t){var i={},u;if(n&&n.userIdentities&&r.isObject(n.userIdentities))for(u in n.userIdentities)i[u]=n.userIdentities[u];return i.device_application_stamp=t,i},preProcessIdentityRequest:function(n,t,i){var r,u;return(mParticle.Logger.verbose(f.InformationMessages.StartingLogEvent+": "+i),r=l.validateIdentities(n,i),!r.valid)?(mParticle.Logger.error("ERROR: "+r.error),{valid:!1,error:r.error}):t&&!l.isFunction(t)?(u="The optional callback must be a function. You tried entering a(n) "+typeof t,mParticle.Logger.error(u),{valid:!1,error:u}):{valid:!0}},createIdentityRequest:function(n,t,i,u,f,e,o){return{client_sdk:{platform:t,sdk_vendor:i,sdk_version:u},context:e,environment:mParticle.preInit.isDevelopmentMode?"development":"production",request_id:r.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:o||null,known_identities:this.createKnownIdentities(n,f)}},createModifyIdentityRequest:function(n,t,i,u,f,e){return{client_sdk:{platform:i,sdk_vendor:u,sdk_version:f},context:e,environment:mParticle.preInit.isDevelopmentMode?"development":"production",request_id:r.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(n,t)}},createIdentityChanges:function(n,t){var u=[],i;if(t&&r.isObject(t)&&n&&r.isObject(n))for(i in t)u.push({old_value:n[c.IdentityType.getIdentityType(i)]||null,new_value:t[i],identity_type:i});return u},modifyUserIdentities:function(n,t){var r={};for(var i in t)r[c.IdentityType.getIdentityType(i)]=t[i];for(i in n)r[i]||(r[i]=n[i]);return r},createAliasNetworkRequest:function(n){return{request_id:r.generateUniqueId(),request_type:"alias",environment:mParticle.preInit.isDevelopmentMode?"development":"production",api_key:mParticle.Store.devToken,data:{destination_mpid:n.destinationMpid,source_mpid:n.sourceMpid,start_unixtime_ms:n.startTime,end_unixtime_ms:n.endTime,device_application_stamp:mParticle.Store.deviceId}}},convertAliasToNative:function(n){return{DestinationMpid:n.destinationMpid,SourceMpid:n.sourceMpid,StartUnixtimeMs:n.startTime,EndUnixtimeMs:n.endTime}},convertToNative:function(n){var i=[],t;if(n&&n.userIdentities){for(t in n.userIdentities)n.userIdentities.hasOwnProperty(t)&&i.push({Type:c.IdentityType.getIdentityType(t),Identity:n.userIdentities[t]});return{UserIdentities:i}}}},a={HTTPCodes:o,identify:function(n,t){var i,c=mParticle.Identity.getCurrentUser(),s=e.preProcessIdentityRequest(n,t,"identify"),l;c&&(i=c.getMPID());s.valid?(l=e.createIdentityRequest(n,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,i),r.canLog()?mParticle.Store.webviewBridgeEnabled?(h.sendToNative(u.NativeSdkPaths.Identify,JSON.stringify(e.convertToNative(n))),r.invokeCallback(t,o.nativeIdentityRequest,"Identify request sent to native sdk")):y(l,"identify",t,n,p,i):(r.invokeCallback(t,o.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(r.invokeCallback(t,o.validationIssue,s.error),mParticle.Logger.verbose(s))},logout:function(n,t){var i,a=mParticle.Identity.getCurrentUser(),s=e.preProcessIdentityRequest(n,t,"logout"),l,v;a&&(i=a.getMPID());s.valid?(v=e.createIdentityRequest(n,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,i),r.canLog()?mParticle.Store.webviewBridgeEnabled?(h.sendToNative(u.NativeSdkPaths.Logout,JSON.stringify(e.convertToNative(n))),r.invokeCallback(t,o.nativeIdentityRequest,"Logout request sent to native sdk")):(y(v,"logout",t,n,p,i),l=d.createEventObject(c.MessageType.Profile),l.ProfileMessageType=c.ProfileMessageType.Logout,mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(n){n.logOut&&n.logOut(l)})):(r.invokeCallback(t,o.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(r.invokeCallback(t,o.validationIssue,s.error),mParticle.Logger.verbose(s))},login:function(n,t){var i,c=mParticle.Identity.getCurrentUser(),s=e.preProcessIdentityRequest(n,t,"login"),l;c&&(i=c.getMPID());s.valid?(l=e.createIdentityRequest(n,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,i),r.canLog()?mParticle.Store.webviewBridgeEnabled?(h.sendToNative(u.NativeSdkPaths.Login,JSON.stringify(e.convertToNative(n))),r.invokeCallback(t,o.nativeIdentityRequest,"Login request sent to native sdk")):y(l,"login",t,n,p,i):(r.invokeCallback(t,o.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(r.invokeCallback(t,o.validationIssue,s.error),mParticle.Logger.verbose(s))},modify:function(n,t){var c,i=mParticle.Identity.getCurrentUser(),s=e.preProcessIdentityRequest(n,t,"modify"),l,a;i&&(c=i.getMPID());l=n&&n.userIdentities?n.userIdentities:{};s.valid?(a=e.createModifyIdentityRequest(i?i.getUserIdentities().userIdentities:{},l,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.context),r.canLog()?mParticle.Store.webviewBridgeEnabled?(h.sendToNative(u.NativeSdkPaths.Modify,JSON.stringify(e.convertToNative(n))),r.invokeCallback(t,o.nativeIdentityRequest,"Modify request sent to native sdk")):y(a,"modify",t,n,p,c):(r.invokeCallback(t,o.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(f.InformationMessages.AbandonLogEvent))):(r.invokeCallback(t,o.validationIssue,s.error),mParticle.Logger.verbose(s))},getCurrentUser:function(){var n=mParticle.Store.mpid;return n?(n=mParticle.Store.mpid.slice(),v(n,mParticle.Store.isLoggedIn)):mParticle.Store.webviewBridgeEnabled?v():null},getUser:function(n){var t=i.getPersistence();return t?t[n]&&!u.SDKv2NonMPIDCookieKeys.hasOwnProperty(n)?v(n):null:null},getUsers:function(){var r=i.getPersistence(),n=[],t;if(r)for(t in r)u.SDKv2NonMPIDCookieKeys.hasOwnProperty(t)||n.push(v(t));return n.sort(function(n,t){var i=n.getLastSeenTime()||0,r=t.getLastSeenTime()||0;return i>r?-1:1}),n},aliasUsers:function(n,t){var i,s;if(n.destinationMpid&&n.sourceMpid||(i=f.ValidationMessages.AliasMissingMpid),n.destinationMpid===n.sourceMpid&&(i=f.ValidationMessages.AliasNonUniqueMpid),n.startTime&&n.endTime||(i=f.ValidationMessages.AliasMissingTime),n.startTime>n.endTime&&(i=f.ValidationMessages.AliasStartBeforeEndTime),i){mParticle.Logger.warning(i);r.invokeAliasCallback(t,o.validationIssue,i);return}r.canLog()?mParticle.Store.webviewBridgeEnabled?(h.sendToNative(u.NativeSdkPaths.Alias,JSON.stringify(e.convertAliasToNative(n))),r.invokeAliasCallback(t,o.nativeIdentityRequest,"Alias request sent to native sdk")):(mParticle.Logger.verbose(f.InformationMessages.StartingAliasRequest+": "+n.sourceMpid+" -> "+n.destinationMpid),s=e.createAliasNetworkRequest(n),it(s,t)):(r.invokeAliasCallback(t,o.loggingDisabledOrMissingAPIKey,f.InformationMessages.AbandonAliasUsers),mParticle.Logger.verbose(f.InformationMessages.AbandonAliasUsers))},createAliasRequest:function(n,t){var i,r,u;try{return!t||!n?(mParticle.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null):(i=n.getFirstSeenTime(),i||mParticle.Identity.getUsers().forEach(function(n){n.getFirstSeenTime()&&(!i||n.getFirstSeenTime()<i)&&(i=n.getFirstSeenTime())}),r=(new Date).getTime()-mParticle.Store.SDKConfig.aliasMaxWindow*864e5,u=n.getLastSeenTime()||(new Date).getTime(),i<r&&(i=r,u<i&&mParticle.Logger.warning("Source User has not been seen in the last "+mParticle.Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail")),{destinationMpid:t.getMPID(),sourceMpid:n.getMPID(),startTime:i,endTime:u})}catch(f){return mParticle.Logger.error("There was a problem with creating an alias request: "+f),null}}};t.exports={IdentityAPI:a,Identity:b,IdentityRequest:e,mParticleUser:v,mParticleUserCart:k}},{"./apiClient":1,"./constants":3,"./cookieSyncManager":4,"./events":6,"./forwarders":7,"./helpers":9,"./nativeSdkHelpers":15,"./persistence":16,"./serverModel":18,"./types":21}],11:[function(n,t){function i(n){var t=n.logLevel||"warning";this.logger=n.hasOwnProperty("logger")?n.logger:new r;this.verbose=function(n){t!=="none"&&this.logger.verbose&&t==="verbose"&&this.logger.verbose(n)};this.warning=function(n){t!=="none"&&this.logger.warning&&(t==="verbose"||t==="warning")&&this.logger.warning(n)};this.error=function(n){t!=="none"&&this.logger.error&&this.logger.error(n)};this.setLogLevel=function(n){t=n}}function r(){this.verbose=function(n){window.console&&window.console.info&&window.console.info(n)};this.error=function(n){window.console&&window.console.error&&window.console.error(n)};this.warning=function(n){window.console&&window.console.warn&&window.console.warn(n)}}t.exports=i},{}],12:[function(n,t){function f(n,t){return{getUserIdentities:function(){var f={},e=r.getUserIdentities(n);for(var o in e)e.hasOwnProperty(o)&&(f[u.IdentityType.getIdentityName(i.parseNumber(o))]=e[o]);return f=i.filterUserIdentitiesForForwarders(f,t.userIdentityFilters),{userIdentities:f}},getMPID:function(){return n},getUserAttributesLists:function(n){var t,u={},r;t=this.getAllUserAttributes();for(r in t)t.hasOwnProperty(r)&&Array.isArray(t[r])&&(u[r]=t[r].slice());return i.filterUserAttributes(u,n.userAttributeFilters)},getAllUserAttributes:function(){var e={},u=r.getAllUserAttributes(n),f;if(u)for(f in u)u.hasOwnProperty(f)&&(e[f]=Array.isArray(u[f])?u[f].slice():u[f]);return i.filterUserAttributes(e,t.userAttributeFilters)}}}var r=n("./persistence"),u=n("./types"),i=n("./helpers");t.exports={getFilteredMparticleUser:f}},{"./helpers":9,"./persistence":16,"./types":21}],13:[function(n){var c=n("./polyfill"),u=n("./types"),o=n("./constants"),r=n("./helpers"),l=n("./nativeSdkHelpers"),k=n("./cookieSyncManager"),t=n("./sessionManager"),h=n("./ecommerce"),y=n("./store"),d=n("./logger"),f=n("./persistence"),g=f.getDeviceId,i=n("./events"),e=o.Messages,s=r.Validators,p=n("./migrations"),w=n("./forwarders"),nt=n("./forwardingStatsUploader"),tt=n("./identity").IdentityRequest,it=n("./identity").Identity,a=n("./identity").IdentityAPI,rt=a.HTTPCodes,v=n("./identity").mParticleUserCart,ut=n("./identity").mParticleUser,b=n("./consent");(function(n){function et(n){var o,t=n,f=t.splice(0,1)[0],u,i,r,e;if(ft[t[0]])ft[f].apply(this,t);else{u=f.split(".");try{for(i=ft,r=0;r<u.length;r++)e=u[r],i=i[e];i.apply(o,t)}catch(s){ft.Logger.verbose("Unable to compute proper mParticle function "+s)}}}Array.prototype.forEach||(Array.prototype.forEach=c.forEach);Array.prototype.map||(Array.prototype.map=c.map);Array.prototype.filter||(Array.prototype.filter=c.filter);Array.isArray||(Array.prototype.isArray=c.isArray);var ft={config:n.mParticle?n.mParticle.config:{},Store:{},getDeviceId:g,generateHash:r.generateHash,sessionManager:t,cookieSyncManager:k,persistence:f,isIOS:n.mParticle&&n.mParticle.isIOS?n.mParticle.isIOS:!1,migrations:p,Identity:a,Validators:s,_Identity:it,_IdentityRequest:tt,IdentityType:u.IdentityType,EventType:u.EventType,CommerceEventType:u.CommerceEventType,PromotionType:u.PromotionActionType,ProductActionType:u.ProductActionType,init:function(u){var k,h,b,c,v;if(arguments&&arguments.length&&arguments.length>1&&typeof arguments[1]=="object"&&(k=arguments[1]),ft.Store=new y(n.mParticle.config,k),ft.Logger=new d(n.mParticle.config),ft.Store.webviewBridgeEnabled=l.isWebviewEnabled(ft.Store.SDKConfig.requiredWebviewBridgeName,ft.Store.SDKConfig.minWebviewBridgeVersion),ft.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_env",value:"webview"})),u&&l.sendToNative(o.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_key",value:u}));else{if(ft.Store.devToken=u||null,ft.Logger.verbose(e.InformationMessages.StartingInitialization),ft.Store.isLocalStorageAvailable=f.determineLocalStorageAvailability(n.localStorage),ft.Logger.verbose(e.InformationMessages.StartingInitialization),p.migrate(),f.initializeStorage(),r.isObject(ft.Store.SDKConfig.identifyRequest)&&r.isObject(ft.Store.SDKConfig.identifyRequest.userIdentities)&&Object.keys(ft.Store.SDKConfig.identifyRequest.userIdentities).length===0||!ft.Store.SDKConfig.identifyRequest){if(b={},h=ft.Identity.getCurrentUser(),h){c=h.getUserIdentities().userIdentities||{};for(v in c)c.hasOwnProperty(v)&&(b[v]=c[v])}ft.Store.SDKConfig.identifyRequest={userIdentities:b}}ft.Store.migratingToIDSyncCookies&&(a.identify(ft.Store.SDKConfig.identifyRequest,ft.Store.SDKConfig.identityCallback),ft.Store.migratingToIDSyncCookies=!1);h=a.getCurrentUser();!ft.Store.identifyCalled&&ft.Store.SDKConfig.identityCallback&&h&&h.getMPID()&&ft.Store.SDKConfig.identityCallback({httpCode:rt.activeSession,getUser:function(){return ut(h.getMPID())},getPreviousUser:function(){var t=ft.Identity.getUsers(),n=t.shift();return n&&h&&n.getMPID()===h.getMPID()&&(n=t.shift()),n||null},body:{mpid:h.getMPID(),is_logged_in:ft.Store.isLoggedIn,matched_identities:h.getUserIdentities().userIdentities,context:null,is_ephemeral:!1}});w.initForwarders(ft.Store.SDKConfig.identifyRequest.userIdentities);r.hasFeatureFlag(o.Features.Batching)&&nt.startForwardingStatsTimer();t.initialize();i.logAST()}ft.preInit.readyQueue&&ft.preInit.readyQueue.length&&(ft.preInit.readyQueue.forEach(function(n){s.isFunction(n)?n():Array.isArray(n)&&et(n)}),ft.preInit.readyQueue=[]);ft.Store.isInitialized=!0;ft.Store.isFirstRun&&(ft.Store.isFirstRun=!1)},setLogLevel:function(n){ft.Logger.setLogLevel(n)},reset:function(t,r){ft.Store&&delete ft.Store;ft.Store=new y(t);ft.Store.isLocalStorageAvailable=f.determineLocalStorageAvailability(n.localStorage);i.stopTracking();r||f.resetPersistence();f.forwardingStatsBatches.uploadsTable={};f.forwardingStatsBatches.forwardingStatsEventQueue=[];ft.preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},featureFlags:{},forwarderConstructors:[],isDevelopmentMode:!1,configuredForwarders:[]}},ready:function(n){ft.Store.isInitialized&&typeof n=="function"?n():ft.preInit.readyQueue.push(n)},getVersion:function(){return o.sdkVersion},setAppVersion:function(n){ft.Store.SDKConfig.appVersion=n;f.update()},getAppName:function(){return ft.Store.SDKConfig.appName},setAppName:function(n){ft.Store.SDKConfig.appName=n},getAppVersion:function(){return ft.Store.SDKConfig.appVersion},stopTrackingLocation:function(){t.resetSessionTimer();i.stopTracking()},startTrackingLocation:function(n){s.isFunction(n)||ft.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location.");t.resetSessionTimer();i.startTracking(n)},setPosition:function(n,i){t.resetSessionTimer();typeof n=="number"&&typeof i=="number"?ft.Store.currentPosition={lat:n,lng:i}:ft.Logger.error("Position latitude and/or longitude must both be of type number")},startNewSession:function(){t.startNewSession()},endSession:function(){t.endSession(!0)},logEvent:function(n,f,o,s){if(t.resetSessionTimer(),typeof n!="string"){ft.Logger.error(e.ErrorMessages.EventNameInvalidType);return}if(f||(f=u.EventType.Unknown),!r.isEventType(f)){ft.Logger.error("Invalid event type: "+f+", must be one of: \n"+JSON.stringify(u.EventType));return}if(!r.canLog()){ft.Logger.error(e.ErrorMessages.LoggingDisabled);return}i.logEvent(u.MessageType.PageEvent,n,o,f,s)},logError:function(n){(t.resetSessionTimer(),n)&&(typeof n=="string"&&(n={message:n}),i.logEvent(u.MessageType.CrashReport,n.name?n.name:"Error",{m:n.message?n.message:n,s:"Error",t:n.stack},u.EventType.Other))},logLink:function(n,r,u,f){t.resetSessionTimer();i.addEventHandler("click",n,r,f,u)},logForm:function(n,r,u,f){t.resetSessionTimer();i.addEventHandler("submit",n,r,f,u)},logPageView:function(f,e,o){if(t.resetSessionTimer(),r.canLog()){if(s.isStringOrNumber(f)||(f="PageView"),e){if(!r.isObject(e)){ft.Logger.error("The attributes argument must be an object. A "+typeof e+" was entered. Please correct and retry.");return}}else e={hostname:n.location.hostname,title:n.document.title};if(o&&!r.isObject(o)){ft.Logger.error("The customFlags argument must be an object. A "+typeof o+" was entered. Please correct and retry.");return}}i.logEvent(u.MessageType.PageView,f,e,u.EventType.Unknown,o)},Consent:{createGDPRConsent:b.createGDPRConsent,createConsentState:b.createConsentState},eCommerce:{Cart:{add:function(n,t){var i,r=ft.Identity.getCurrentUser();r&&(i=r.getMPID());v(i).add(n,t)},remove:function(n,t){var i,r=ft.Identity.getCurrentUser();r&&(i=r.getMPID());v(i).remove(n,t)},clear:function(){var n,t=ft.Identity.getCurrentUser();t&&(n=t.getMPID());v(n).clear()}},setCurrencyCode:function(n){if(typeof n!="string"){ft.Logger.error("Code must be a string");return}t.resetSessionTimer();ft.Store.currencyCode=n},createProduct:function(n,i,r,u,f,e,o,s,c,l){return t.resetSessionTimer(),h.createProduct(n,i,r,u,f,e,o,s,c,l)},createPromotion:function(n,i,r,u){return t.resetSessionTimer(),h.createPromotion(n,i,r,u)},createImpression:function(n,i){return t.resetSessionTimer(),h.createImpression(n,i)},createTransactionAttributes:function(n,i,r,u,f,e){return t.resetSessionTimer(),h.createTransactionAttributes(n,i,r,u,f,e)},logCheckout:function(n,r,u,f){t.resetSessionTimer();i.logCheckoutEvent(n,r,u,f)},logProductAction:function(n,r,u,f){t.resetSessionTimer();i.logProductActionEvent(n,r,u,f)},logPurchase:function(n,r,u,f,o){if(!n||!r){ft.Logger.error(e.ErrorMessages.BadLogPurchase);return}t.resetSessionTimer();i.logPurchaseEvent(n,r,f,o);u===!0&&ft.eCommerce.Cart.clear()},logPromotion:function(n,r,u,f){t.resetSessionTimer();i.logPromotionEvent(n,r,u,f)},logImpression:function(n,r,u){t.resetSessionTimer();i.logImpressionEvent(n,r,u)},logRefund:function(n,r,u,f,e){t.resetSessionTimer();i.logRefundEvent(n,r,f,e);u===!0&&ft.eCommerce.Cart.clear()},expandCommerceEvent:function(n){return t.resetSessionTimer(),h.expandCommerceEvent(n)}},setSessionAttribute:function(n,i){if(t.resetSessionTimer(),r.canLog()){if(!s.isValidAttributeValue(i)){ft.Logger.error(e.ErrorMessages.BadAttribute);return}if(!s.isValidKeyValue(n)){ft.Logger.error(e.ErrorMessages.BadKey);return}if(ft.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:n,value:i}));else{var u=r.findKeyInObject(ft.Store.sessionAttributes,n);u&&(n=u);ft.Store.sessionAttributes[n]=i;f.update();w.applyToForwarders("setSessionAttribute",[n,i])}}},setOptOut:function(n){t.resetSessionTimer();ft.Store.isEnabled=!n;i.logOptOut();f.update();ft.Store.activeForwarders.length&&ft.Store.activeForwarders.forEach(function(t){if(t.setOptOut){var i=t.setOptOut(n);i&&ft.Logger.verbose(i)}})},setIntegrationAttribute:function(n,t){if(typeof n!="number"){ft.Logger.error("integrationId must be a number");return}if(t===null)ft.Store.integrationAttributes[n]={};else if(r.isObject(t))if(Object.keys(t).length===0)ft.Store.integrationAttributes[n]={};else for(var i in t)if(typeof i=="string")if(typeof t[i]=="string")r.isObject(ft.Store.integrationAttributes[n])?ft.Store.integrationAttributes[n][i]=t[i]:(ft.Store.integrationAttributes[n]={},ft.Store.integrationAttributes[n][i]=t[i]);else{ft.Logger.error("Values for integration attributes must be strings. You entered a "+typeof t[i]);continue}else{ft.Logger.error("Keys must be strings, you entered a "+typeof i);continue}else{ft.Logger.error("Attrs must be an object with keys and values. You entered a "+typeof t);return}f.update()},getIntegrationAttributes:function(n){return ft.Store.integrationAttributes[n]?ft.Store.integrationAttributes[n]:{}},addForwarder:function(n){ft.preInit.forwarderConstructors.push(n)},configureForwarder:function(n){for(var i=null,t=n,r=0;r<ft.preInit.forwarderConstructors.length;r++)if(ft.preInit.forwarderConstructors[r].name===t.name&&(t.isDebug===ft.preInit.isDevelopmentMode||t.isSandbox===ft.preInit.isDevelopmentMode)){i=new ft.preInit.forwarderConstructors[r].constructor;i.id=t.moduleId;i.isSandbox=t.isDebug||t.isSandbox;i.hasSandbox=t.hasDebugString==="true";i.isVisible=t.isVisible;i.settings=t.settings;i.eventNameFilters=t.eventNameFilters;i.eventTypeFilters=t.eventTypeFilters;i.attributeFilters=t.attributeFilters;i.screenNameFilters=t.screenNameFilters;i.screenNameFilters=t.screenNameFilters;i.pageViewAttributeFilters=t.pageViewAttributeFilters;i.userIdentityFilters=t.userIdentityFilters;i.userAttributeFilters=t.userAttributeFilters;i.filteringEventAttributeValue=t.filteringEventAttributeValue;i.filteringUserAttributeValue=t.filteringUserAttributeValue;i.eventSubscriptionId=t.eventSubscriptionId;i.filteringConsentRuleValues=t.filteringConsentRuleValues;i.excludeAnonymousUser=t.excludeAnonymousUser;ft.preInit.configuredForwarders.push(i);break}},configurePixel:function(n){(n.isDebug===ft.preInit.isDevelopmentMode||n.isProduction!==ft.preInit.isDevelopmentMode)&&ft.preInit.pixelConfigurations.push(n)},_getActiveForwarders:function(){return ft.Store.activeForwarders},_getIntegrationDelays:function(){return ft.preInit.integrationDelays},_configureFeatures:function(n){for(var t in n)ft.Store&&ft.preInit.featureFlags&&(ft.preInit.featureFlags[t]=n[t])},_setIntegrationDelay:function(n,t){ft.preInit.integrationDelays[n]=t}};ft.preInit={readyQueue:[],configuredForwarders:[],featureFlags:{},forwarderConstructors:[],pixelConfigurations:[],integrationDelays:{},isDevelopmentMode:!1};n.mParticle&&n.mParticle.config&&(ft.preInit.isDevelopmentMode=n.mParticle.config.hasOwnProperty("isDevelopmentMode")?r.returnConvertedBoolean(n.mParticle.config.isDevelopmentMode):!1,n.mParticle.config.hasOwnProperty("rq")&&(ft.preInit.readyQueue=n.mParticle.config.rq));n.mParticle=ft})(window)},{"./consent":2,"./constants":3,"./cookieSyncManager":4,"./ecommerce":5,"./events":6,"./forwarders":7,"./forwardingStatsUploader":8,"./helpers":9,"./identity":10,"./logger":11,"./migrations":14,"./nativeSdkHelpers":15,"./persistence":16,"./polyfill":17,"./sessionManager":19,"./store":20,"./types":21}],14:[function(n,t){function y(){try{p()}catch(n){r.expireCookies(i.cookieNameV3);r.expireCookies(i.cookieNameV4);mParticle.Logger.error("Error migrating cookie: "+n)}if(mParticle.Store.isLocalStorageAvailable)try{b()}catch(n){localStorage.removeItem(i.localStorageNameV3);localStorage.removeItem(i.localStorageNameV4);mParticle.Logger.error("Error migrating localStorage: "+n)}}function p(){var l=window.document.cookie.split("; "),r,n,a,e,t,c;for(mParticle.Logger.verbose(u.Messages.InformationMessages.CookieSearch),n=0,a=l.length;n<a;n++){if(e=l[n].split("="),t=f.decoded(e.shift()),c=f.decoded(e.join("=")),r,t===mParticle.Store.storageName)return;if(t===i.cookieNameV4){s(c,i.cookieNameV4);mParticle.Store.isLocalStorageAvailable&&h();return}if(t===i.cookieNameV3){r=o(c);s(r,i.cookieNameV3);break}}}function s(n,t){var s=new Date,f=r.getCookieDomain(),e,o;e=new Date(s.getTime()+i.CookieExpiration*864e5).toGMTString();o=f===""?"":";domain="+f;mParticle.Logger.verbose(u.Messages.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(mParticle.Store.storageName)+"="+n+";expires="+e+";path=/"+o;r.expireCookies(t);mParticle.Store.migratingToIDSyncCookies=!0}function o(n){n=r.replacePipesWithCommas(r.replaceApostrophesWithQuotes(n));var t=JSON.parse(n),i=JSON.parse(w(n));return t.mpid&&(i.gs.csm.push(t.mpid),i.gs.csm=e.encode(JSON.stringify(i.gs.csm)),c(t,t.mpid)),JSON.stringify(i)}function w(n){var i,t;try{i={gs:{csm:[]}};n=JSON.parse(n);for(t in n)n.hasOwnProperty(t)&&(a[t]?i.gs[t]=n[t]:t==="mpid"?i.cu=n[t]:n.mpid&&(i[n.mpid]=i[n.mpid]||{},v[t]&&(i[n.mpid][t]=n[t])));return JSON.stringify(i)}catch(r){mParticle.Logger.error("Failed to restructure previous cookie into most current cookie schema")}}function h(){var n=i.localStorageProductsV4,t=localStorage.getItem(i.localStorageProductsV4);localStorage.setItem(mParticle.Store.prodStorageName,t);localStorage.removeItem(n)}function c(n,t){if(mParticle.Store.isLocalStorageAvailable){var i={};if(i[t]={},n.cp){try{i[t].cp=JSON.parse(e.decode(n.cp))}catch(r){i[t].cp=n.cp}Array.isArray(i[t].cp)||(i[t].cp=[])}localStorage.setItem(mParticle.Store.prodStorageName,e.encode(JSON.stringify(i)))}}function b(){function l(n,t){try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.storageName),n)}catch(i){mParticle.Logger.error("Error with setting localStorage item.")}window.localStorage.removeItem(encodeURIComponent(t))}var t,f=i.localStorageNameV3,e=i.localStorageNameV4,a=window.localStorage.getItem(mParticle.Store.storageName),u,n,s;if(!a){if(u=window.localStorage.getItem(e),u){l(u,e);h();return}if(n=window.localStorage.getItem(f),n){if(mParticle.Store.migratingToIDSyncCookies=!0,s=n.slice(),n=JSON.parse(r.replacePipesWithCommas(r.replaceApostrophesWithQuotes(n))),n.mpid){n=JSON.parse(o(s));l(JSON.stringify(n),f);return}if((n.cp||n.pb)&&!n.mpid){if(t=r.getCookie(),t){c(n,t.cu);localStorage.removeItem(i.localStorageNameV3);return}localStorage.removeItem(i.localStorageNameV3);return}}}}function k(n){try{if(n&&f.isObject(n))for(var t in n)n.hasOwnProperty(t)&&(l[t]||n[t].ui&&Array.isArray(n[t].ui)&&(n[t].ui=n[t].ui.reduce(function(n,t){return t.Type&&f.Validators.isStringOrNumber(t.Identity)&&(n[t.Type]=t.Identity),n},{})));return n}catch(i){mParticle.Logger.error("An error ocurred when converting the user identities array to an object",i)}}var r=n("./persistence"),u=n("./constants"),i=u.StorageNames,f=n("./helpers"),l=u.SDKv2NonMPIDCookieKeys,e=n("./polyfill").Base64,a={das:1},v={ui:1};t.exports={migrate:y,convertUIFromArrayToObject:k,convertSDKv1CookiesV3ToSDKv2CookiesV4:o}},{"./constants":3,"./helpers":9,"./persistence":16,"./polyfill":17}],15:[function(n,t){function e(n){if(!n)return!1;var i=f+"_"+n+"_v2",t=r+"_"+n+"_v2";return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(t)?!0:window.mParticle.uiwebviewBridgeName===t?!0:window.hasOwnProperty(i)?!0:!1}function h(n,t){return(mParticle.Store.bridgeV2Available=e(n),mParticle.Store.bridgeV1Available=c(),t===2)?mParticle.Store.bridgeV2Available:window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName!==r+"_"+n+"_v2"?!1:t<2?mParticle.Store.bridgeV2Available||mParticle.Store.bridgeV1Available:!1}function c(){return mParticle.Store.SDKConfig.useNativeSdk||window.mParticleAndroid||mParticle.Store.SDKConfig.isIOS?!0:!1}function l(n,t){if(mParticle.Store.bridgeV2Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion===2){u(n,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName);return}if(mParticle.Store.bridgeV2Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2){u(n,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName);return}if(mParticle.Store.bridgeV1Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2){o(n,t);return}}function o(n,t){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(n)?(mParticle.Logger.verbose(i.InformationMessages.SendAndroid+n),window.mParticleAndroid[n](t)):mParticle.Store.SDKConfig.isIOS&&(mParticle.Logger.verbose(i.InformationMessages.SendIOS+n),s(n,t))}function s(n,t){var i=document.createElement("IFRAME");i.setAttribute("src","mp-sdk://"+n+"/"+encodeURIComponent(t));document.documentElement.appendChild(i);i.parentNode.removeChild(i);i=null}function u(n,t,u){if(u){var l=f+"_"+u+"_v2",o=window[l],e=r+"_"+u+"_v2",h,c;if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[e]&&(h=window.webkit.messageHandlers[e]),window.mParticle.uiwebviewBridgeName===e&&(c=window.mParticle[e]),o&&o.hasOwnProperty(n)){mParticle.Logger.verbose(i.InformationMessages.SendAndroid+n);o[n](t);return}h?(mParticle.Logger.verbose(i.InformationMessages.SendIOS+n),h.postMessage(JSON.stringify({path:n,value:t?JSON.parse(t):null}))):c&&(mParticle.Logger.verbose(i.InformationMessages.SendIOS+n),s(n,t))}}var i=n("./constants").Messages,f="mParticleAndroid",r="mParticle";t.exports={isWebviewEnabled:h,isBridgeV2Available:e,sendToNative:l,sendViaBridgeV1:o,sendViaBridgeV2:u}},{"./constants":3}],16:[function(n,t){function d(){return!mParticle.Store.SDKConfig.useCookieStorage&&mParticle.Store.isLocalStorageAvailable}function st(){var s,t,n,u,e,h,f;try{t=this.getLocalStorage();n=this.getCookie();t||n?mParticle.Store.isFirstRun=!1:(mParticle.Store.isFirstRun=!0,mParticle.Store.mpid=0);mParticle.Store.isLocalStorageAvailable||(mParticle.Store.SDKConfig.useCookieStorage=!0);mParticle.Store.isLocalStorageAvailable?(s=window.localStorage,mParticle.Store.SDKConfig.useCookieStorage?(t?(u=n?i.extend(!1,t,n):t,s.removeItem(mParticle.Store.storageName)):n&&(u=n),this.storeDataInMemory(u)):n?(u=t?i.extend(!1,t,n):n,this.storeDataInMemory(u),this.expireCookies(mParticle.Store.storageName)):this.storeDataInMemory(t)):this.storeDataInMemory(n);try{mParticle.Store.isLocalStorageAvailable&&(e=localStorage.getItem(mParticle.Store.prodStorageName),e&&(h=JSON.parse(r.decode(e))),mParticle.Store.mpid&&ct(h,mParticle.Store.mpid))}catch(l){mParticle.Store.isLocalStorageAvailable&&localStorage.removeItem(mParticle.Store.prodStorageName);mParticle.Store.cartProducts=[];mParticle.Logger.error("Error loading products in initialization: "+l)}for(f in u)u.hasOwnProperty(f)&&(c[f]||(mParticle.Store.nonCurrentUserMPIDs[f]=u[f]));this.update()}catch(l){d()&&mParticle.Store.isLocalStorageAvailable?localStorage.removeItem(mParticle.Store.storageName):o(mParticle.Store.storageName);mParticle.Logger.error("Error initializing storage: "+l)}}function ht(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.SDKConfig.useCookieStorage&&this.setCookie(),this.setLocalStorage())}function ct(n,t){if(n)try{mParticle.Store.cartProducts=n[t]&&n[t].cp?n[t].cp:[]}catch(i){mParticle.Logger.error(h.ErrorMessages.CookieParseError)}}function lt(n,t){try{n?(mParticle.Store.mpid=t?t:n.cu||0,n.gs=n.gs||{},mParticle.Store.sessionId=n.gs.sid||mParticle.Store.sessionId,mParticle.Store.isEnabled=typeof n.gs.ie!="undefined"?n.gs.ie:mParticle.Store.isEnabled,mParticle.Store.sessionAttributes=n.gs.sa||mParticle.Store.sessionAttributes,mParticle.Store.serverSettings=n.gs.ss||mParticle.Store.serverSettings,mParticle.Store.devToken=mParticle.Store.devToken||n.gs.dt,mParticle.Store.SDKConfig.appVersion=mParticle.Store.SDKConfig.appVersion||n.gs.av,mParticle.Store.clientId=n.gs.cgid||mParticle.Store.clientId||i.generateUniqueId(),mParticle.Store.deviceId=n.gs.das||mParticle.Store.deviceId||i.generateUniqueId(),mParticle.Store.integrationAttributes=n.gs.ia||{},mParticle.Store.context=n.gs.c||mParticle.Store.context,mParticle.Store.currentSessionMPIDs=n.gs.csm||mParticle.Store.currentSessionMPIDs,mParticle.Store.isLoggedIn=n.l===!0,n.gs.les&&(mParticle.Store.dateLastEventSent=new Date(n.gs.les)),mParticle.Store.sessionStartDate=n.gs.ssd?new Date(n.gs.ssd):new Date,n=t?n[t]:n[n.cu]):(mParticle.Logger.verbose(h.InformationMessages.CookieNotFound),mParticle.Store.clientId=mParticle.Store.clientId||i.generateUniqueId(),mParticle.Store.deviceId=mParticle.Store.deviceId||i.generateUniqueId())}catch(r){mParticle.Logger.error(h.ErrorMessages.CookieParseError)}}function at(n){var t;mParticle._forceNoLocalStorage&&(n=undefined);try{return n.setItem("mparticle","test"),t=n.getItem("mparticle")==="test",n.removeItem("mparticle"),t&&n}catch(i){return!1}}function vt(n){if(!mParticle.Store.isLocalStorageAvailable)return[];var i,t,u=localStorage.getItem(mParticle.Store.prodStorageName);if(u&&(i=r.decode(u)),n)try{return i&&(t=JSON.parse(i)),i&&t[n]&&t[n].cp&&Array.isArray(t[n].cp)?t[n].cp:[]}catch(f){return[]}else return[]}function g(){var t,i=localStorage.getItem(mParticle.Store.prodStorageName),n;i&&(t=r.decode(i));try{n=JSON.parse(t)}catch(u){n={}}return n}function yt(){if(mParticle.Store.isLocalStorageAvailable){var e=mParticle.Store.storageName,t=g(),n=this.getLocalStorage()||{},f=mParticle.Identity.getCurrentUser(),u=f?f.getMPID():null,o={cp:t[u]?t[u].cp:[]};if(u){t=t||{};t[u]=o;try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),r.encode(JSON.stringify(t)))}catch(s){mParticle.Logger.error("Error with setting products on localStorage.")}}if(!mParticle.Store.SDKConfig.useCookieStorage){n.gs=n.gs||{};n.l=mParticle.Store.isLoggedIn?1:0;mParticle.Store.sessionId&&(n.gs.csm=mParticle.Store.currentSessionMPIDs);n.gs.ie=mParticle.Store.isEnabled;u&&(n.cu=u);Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(n=i.extend({},n,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={});n=this.setGlobalStorageAttributes(n);try{window.localStorage.setItem(encodeURIComponent(e),v(JSON.stringify(n)))}catch(s){mParticle.Logger.error("Error with setting localStorage item.")}}}}function pt(n){var t=mParticle.Store;return n.gs.sid=t.sessionId,n.gs.ie=t.isEnabled,n.gs.sa=t.sessionAttributes,n.gs.ss=t.serverSettings,n.gs.dt=t.devToken,n.gs.les=t.dateLastEventSent?t.dateLastEventSent.getTime():null,n.gs.av=t.SDKConfig.appVersion,n.gs.cgid=t.clientId,n.gs.das=t.deviceId,n.gs.c=t.context,n.gs.ssd=t.sessionStartDate?t.sessionStartDate.getTime():null,n.gs.ia=t.integrationAttributes,n}function nt(){if(!mParticle.Store.isLocalStorageAvailable)return null;var r=mParticle.Store.storageName,n=k(window.localStorage.getItem(r)),i={},t;if(n){n=JSON.parse(n);for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t])}return Object.keys(i).length?i:null}function e(n){localStorage.removeItem(n)}function wt(){return mParticle.Store.deviceId?mParticle.Store.deviceId:this.parseDeviceId(mParticle.Store.serverSettings)}function bt(n){try{var t={},r;return n&&n.uid&&n.uid.Value&&(n.uid.Value.split("&").forEach(function(n){r=n.split("=");t[r[0]]=r[1]}),t.g)?t.g:i.generateUniqueId()}catch(u){return i.generateUniqueId()}}function o(n){var t=new Date,r,u,i;i=y();u=i===""?"":";domain="+i;t.setTime(t.getTime()-864e5);r="; expires="+t.toUTCString();document.cookie=n+"="+r+"; path=/"+u}function tt(){var o=window.document.cookie.split("; "),n=mParticle.Store.storageName,t,s,u,f,e,r=n?undefined:{};for(mParticle.Logger.verbose(h.InformationMessages.CookieSearch),t=0,s=o.length;t<s;t++){if(u=o[t].split("="),f=i.decoded(u.shift()),e=i.decoded(u.join("=")),n&&n===f){r=i.converted(e);break}n||(r[f]=i.converted(e))}return r?(mParticle.Logger.verbose(h.InformationMessages.CookieFound),JSON.parse(k(r))):null}function kt(){var t,u=mParticle.Identity.getCurrentUser();u&&(t=u.getMPID());var o=new Date,s=mParticle.Store.storageName,n=this.getCookie()||{},c=new Date(o.getTime()+mParticle.Store.SDKConfig.cookieExpiration*864e5).toGMTString(),r,f,e;r=y();f=r===""?"":";domain="+r;n.gs=n.gs||{};mParticle.Store.sessionId&&(n.gs.csm=mParticle.Store.currentSessionMPIDs);t&&(n.cu=t);n.l=mParticle.Store.isLoggedIn?1:0;n=this.setGlobalStorageAttributes(n);Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(n=i.extend({},n,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={});e=w(n,c,f,mParticle.Store.SDKConfig.maxCookieSize);mParticle.Logger.verbose(h.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(s)+"="+e}function w(n,t,i,r){var u,s=n.gs.csm?n.gs.csm:[],f,e,o,h,l,a;if(s.length){e={};for(o in n)n.hasOwnProperty(o)&&(c[o]||o===n.cu||(e[o]=1));if(Object.keys(e).length)for(h in e)u=b(n,t,i),u.length>r&&e.hasOwnProperty(h)&&s.indexOf(h)===-1&&delete n[h];for(l=0;l<s.length;l++)if(u=b(n,t,i),u.length>r)a=s[l],n[a]?(mParticle.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+r+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(n[a],0,2)),delete n[a]):mParticle.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+r+". We recommend using a maxCookieSize of 1500.");else break}else for(f in n)n.hasOwnProperty(f)&&(u=b(n,t,i),u.length>r&&(c[f]||f===n.cu||delete n[f]));return u}function b(n,t,i){return v(JSON.stringify(n))+";expires="+t+";path=/"+i}function dt(n){var t=this.getCookie()||this.getLocalStorage(),r,u,i,f,e;if(n)for(u in n.userIdentities)if(t&&Object.keys(t).length)for(i in t)if(t[i].mpid){f=t[i].ui;for(e in f)if(u===e&&n.userIdentities[u]===f[e]){r=i;break}}r&&this.storeDataInMemory(t,r)}function v(n){var t,u;n=JSON.parse(n);for(t in n.gs)n.gs.hasOwnProperty(t)&&(a[t]?n.gs[t]?Array.isArray(n.gs[t])&&n.gs[t].length?n.gs[t]=r.encode(JSON.stringify(n.gs[t])):i.isObject(n.gs[t])&&Object.keys(n.gs[t]).length?n.gs[t]=r.encode(JSON.stringify(n.gs[t])):delete n.gs[t]:delete n.gs[t]:t==="ie"?n.gs[t]=n.gs[t]?1:0:n.gs[t]||delete n.gs[t]);for(u in n)if(n.hasOwnProperty(u)&&!c[u])for(t in n[u])n[u].hasOwnProperty(t)&&a[t]&&(i.isObject(n[u][t])&&Object.keys(n[u][t]).length?n[u][t]=r.encode(JSON.stringify(n[u][t])):delete n[u][t]);return et(JSON.stringify(n))}function k(n){var t,u;try{if(n){if(n=JSON.parse(ot(n)),i.isObject(n)&&Object.keys(n).length){for(t in n.gs)n.gs.hasOwnProperty(t)&&(a[t]?n.gs[t]=JSON.parse(r.decode(n.gs[t])):t==="ie"&&(n.gs[t]=Boolean(n.gs[t])));for(u in n)if(n.hasOwnProperty(u))if(c[u])u==="l"&&(n[u]=Boolean(n[u]));else for(t in n[u])n[u].hasOwnProperty(t)&&a[t]&&n[u][t].length&&(n[u][t]=JSON.parse(r.decode(n[u][t])))}return JSON.stringify(n)}}catch(f){mParticle.Logger.error("Problem with decoding cookie",f)}}function it(n){return n.replace(/,/g,"|")}function rt(n){return n.replace(/\|/g,",")}function ut(n){return n.replace(/\'/g,'"')}function ft(n){return n.replace(/\"/g,"'")}function et(n){return it(ft(n))}function ot(n){return rt(ut(n))}function y(){if(mParticle.Store.SDKConfig.cookieDomain)return mParticle.Store.SDKConfig.cookieDomain;var n=gt(document,location.hostname);return n===""?"":"."+n}function gt(n,t){for(var r,u="mptest=cookie",f=t.split("."),i=f.length-1;i>=0;i--)if(r=f.slice(i).join("."),n.cookie=u+";domain=."+r+";",n.cookie.indexOf(u)>-1)return n.cookie=u.split("=")[0]+"=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",r;return""}function ni(){return JSON.parse(r.decode(localStorage.getItem(mParticle.Store.prodStorageName)))}function ti(n){var t=u();return t&&t[n]&&t[n].ui?t[n].ui:{}}function ii(n){var t=u();return t&&t[n]&&t[n].ua?t[n].ua:{}}function ri(n){var t=JSON.parse(r.decode(localStorage.getItem(mParticle.Store.prodStorageName)));return t&&t[n]&&t[n].cp?t[n].cp:[]}function ui(n){if(mParticle.Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),r.encode(JSON.stringify(n)))}catch(t){mParticle.Logger.error("Error with setting products on localStorage.")}}function fi(n,t){if(t){var i=u();i&&(i[n]?i[n].ui=t:i[n]={ui:t},s(i))}}function ei(n,t){var i=u();t&&(i&&(i[n]?i[n].ui=t:i[n]={ui:t}),s(i))}function oi(n,t){if(t){var i=u();i&&(i[n]?i[n].csd=t:i[n]={csd:t});s(i)}}function si(n,t){if(t||t===null){var i=u();i&&(i[n]?i[n].con=p.Serialization.toMinifiedJsonObject(t):i[n]={con:p.Serialization.toMinifiedJsonObject(t)},s(i))}}function s(n){var u=v(JSON.stringify(n)),f=new Date,e=mParticle.Store.storageName,o=new Date(f.getTime()+mParticle.Store.SDKConfig.cookieExpiration*864e5).toGMTString(),t=y(),i,r;i=t===""?"":";domain="+t;mParticle.Store.SDKConfig.useCookieStorage?(r=w(n,o,i,mParticle.Store.SDKConfig.maxCookieSize),window.document.cookie=encodeURIComponent(e)+"="+r):mParticle.Store.isLocalStorageAvailable&&localStorage.setItem(mParticle.Store.storageName,u)}function u(){return mParticle.Store.SDKConfig.useCookieStorage?tt():nt()}function hi(n){var t=u();return t&&t[n]&&t[n].con?p.Serialization.fromMinifiedJsonObject(t[n].con):null}function ci(n){if(!n)return null;var t=u();return t&&t[n]&&t[n].fst?t[n].fst:null}function li(n,t){if(n){t||(t=(new Date).getTime());var i=u();i&&(i[n]||(i[n]={}),i[n].fst||(i[n].fst=t,s(i)))}}function ai(n){if(!n)return null;if(n===mParticle.Identity.getCurrentUser().getMPID())return(new Date).getTime();var t=u();return t&&t[n]&&t[n].lst?t[n].lst:null}function vi(n,t){if(n){t||(t=(new Date).getTime());var i=u();i&&i[n]&&(i[n].lst=t,s(i))}}function yi(){return mParticle.Store.deviceId}function pi(){if(e(f.localStorageName),e(f.localStorageNameV3),e(f.localStorageNameV4),e(mParticle.Store.prodStorageName),e(f.localStorageProductsV4),o(f.cookieName),o(f.cookieNameV2),o(f.cookieNameV3),o(f.cookieNameV4),mParticle._isTestEnv){var n="abcdef";e(i.createMainStorageName(n));o(i.createMainStorageName(n));e(i.createProductStorageName(n))}}var i=n("./helpers"),l=n("./constants"),r=n("./polyfill").Base64,h=l.Messages,a=l.Base64CookieKeys,c=l.SDKv2NonMPIDCookieKeys,f=l.StorageNames,p=n("./consent");t.exports={useLocalStorage:d,initializeStorage:st,update:ht,determineLocalStorageAvailability:at,getUserProductsFromLS:vt,getAllUserProductsFromLS:g,setLocalStorage:yt,setGlobalStorageAttributes:pt,getLocalStorage:nt,storeDataInMemory:lt,retrieveDeviceId:wt,parseDeviceId:bt,expireCookies:o,getCookie:tt,setCookie:kt,reduceAndEncodeCookies:w,findPrevCookiesBasedOnUI:dt,replaceCommasWithPipes:it,replacePipesWithCommas:rt,replaceApostrophesWithQuotes:ut,replaceQuotesWithApostrophes:ft,createCookieString:et,revertCookieString:ot,encodeCookies:v,decodeCookies:k,getCookieDomain:y,decodeProducts:ni,getUserIdentities:ti,getAllUserAttributes:ii,getCartProducts:ri,setCartProducts:ui,saveCookies:s,saveUserIdentitiesToCookies:fi,saveUserAttributesToCookies:ei,saveUserCookieSyncDatesToCookies:oi,saveUserConsentStateToCookies:si,getPersistence:u,getDeviceId:yi,resetPersistence:pi,getConsentState:hi,forwardingStatsBatches:{uploadsTable:{},forwardingStatsEventQueue:[]},getFirstSeenTime:ci,getLastSeenTime:ai,setFirstSeenTime:li,setLastSeenTime:vi}},{"./consent":2,"./constants":3,"./helpers":9,"./polyfill":17}],17:[function(n,t){var i={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(n)))}catch(t){window.console.log("Error encoding cookie values into Base64:"+t)}return this._encode(n)},_encode:function(n){var o="",s,t,u,c,l,h,f,e=0;for(n=r.encode(n);e<n.length;)s=n.charCodeAt(e++),t=n.charCodeAt(e++),u=n.charCodeAt(e++),c=s>>2,l=(s&3)<<4|t>>4,h=(t&15)<<2|u>>6,f=u&63,isNaN(t)?h=f=64:isNaN(u)&&(f=64),o=o+i._keyStr.charAt(c)+i._keyStr.charAt(l)+i._keyStr.charAt(h)+i._keyStr.charAt(f);return o},decode:function(n){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(n)))}catch(t){}return i._decode(n)},_decode:function(n){var t="",s,h,c,l,e,f,o,u=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<n.length;)l=i._keyStr.indexOf(n.charAt(u++)),e=i._keyStr.indexOf(n.charAt(u++)),f=i._keyStr.indexOf(n.charAt(u++)),o=i._keyStr.indexOf(n.charAt(u++)),s=l<<2|e>>4,h=(e&15)<<4|f>>2,c=(f&3)<<6|o,t=t+String.fromCharCode(s),f!==64&&(t=t+String.fromCharCode(h)),o!==64&&(t=t+String.fromCharCode(c));return r.decode(t)}},r={encode:function(n){for(var t,i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},decode:function(n){for(var r="",t=0,i=0,u=0,f=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(u=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|u&63),t+=2):(u=n.charCodeAt(t+1),f=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(u&63)<<6|f&63),t+=3);return r}};t.exports={forEach:function(n,t){var u,i,r,f,e;if(this==null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++},map:function(n,t){var e,u,i,r,f,o,s;if(this===null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(e=t),u=new Array(f),i=0;i<f;)i in r&&(o=r[i],s=n.call(e,o,i,r),u[i]=s),i++;return u},filter:function(n){"use strict";var i,f,r,e,t,u;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),f=i.length>>>0,typeof n!="function")throw new TypeError;for(r=[],e=arguments.length>=2?arguments[1]:void 0,t=0;t<f;t++)t in i&&(u=i[t],n.call(e,u,t,i)&&r.push(u));return r},isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},Base64:i}},{}],18:[function(n,t){function c(n,t){var r=[],i;t.flags={};for(i in n.CustomFlags)r=[],n.CustomFlags.hasOwnProperty(i)&&(Array.isArray(n.CustomFlags[i])?n.CustomFlags[i].forEach(function(n){(typeof n=="number"||typeof n=="string"||typeof n=="boolean")&&r.push(n.toString())}):(typeof n.CustomFlags[i]=="number"||typeof n.CustomFlags[i]=="string"||typeof n.CustomFlags[i]=="boolean")&&r.push(n.CustomFlags[i].toString()),r.length&&(t.flags[i]=r))}function e(n){return n?n.map(function(n){return l(n)}):[]}function l(n){return{id:u.parseStringOrNumber(n.Sku),nm:u.parseStringOrNumber(n.Name),pr:i(n.Price),qt:i(n.Quantity),br:u.parseStringOrNumber(n.Brand),va:u.parseStringOrNumber(n.Variant),ca:u.parseStringOrNumber(n.Category),ps:i(n.Position),cc:u.parseStringOrNumber(n.CouponCode),tpa:i(n.TotalAmount),attrs:n.Attributes}}function o(n){var f,u,r,i,t;if(!n)return null;if(f={},u=n.getGDPRConsentState(),u){r={};f.gdpr=r;for(i in u)u.hasOwnProperty(i)&&(t=u[i],f.gdpr[i]={},typeof t.Consented=="boolean"&&(r[i].c=t.Consented),typeof t.Timestamp=="number"&&(r[i].ts=t.Timestamp),typeof t.ConsentDocument=="string"&&(r[i].d=t.ConsentDocument),typeof t.Location=="string"&&(r[i].l=t.Location),typeof t.HardwareId=="string"&&(r[i].h=t.HardwareId))}return f}function a(n,t,i,f,e){var s,l={},o=mParticle.Identity.getCurrentUser(),a=o?o.getUserIdentities().userIdentities:{},v=n===r.MessageType.OptOut?!mParticle.Store.isEnabled:null,c;if(i=u.sanitizeAttributes(i),mParticle.Store.sessionId||n==r.MessageType.OptOut||mParticle.Store.webviewBridgeEnabled){for(c in a)l[r.IdentityType.getIdentityType(c)]=a[c];return n!==r.MessageType.SessionEnd&&(mParticle.Store.dateLastEventSent=new Date),s={EventName:t||n,EventCategory:f,UserAttributes:o?o.getAllUserAttributes():{},UserIdentities:l,Store:mParticle.Store.serverSettings,EventAttributes:i,SDKVersion:h.sdkVersion,SessionId:mParticle.Store.sessionId,EventDataType:n,Debug:mParticle.preInit.isDevelopmentMode,Location:mParticle.Store.currentPosition,OptOut:v,ExpandedEventCount:0,CustomFlags:e,AppVersion:mParticle.Store.SDKConfig.appVersion,ClientGeneratedId:mParticle.Store.clientId,DeviceId:mParticle.Store.deviceId,MPID:o?o.getMPID():null,ConsentState:o?o.getConsentState():null,IntegrationAttributes:mParticle.Store.integrationAttributes},n===r.MessageType.SessionEnd&&(s.SessionLength=mParticle.Store.dateLastEventSent.getTime()-mParticle.Store.sessionStartDate.getTime(),s.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs,s.EventAttributes=mParticle.Store.sessionAttributes,mParticle.Store.currentSessionMPIDs=[]),s.Timestamp=mParticle.Store.dateLastEventSent.getTime(),s}return null}function v(n,t,r){var u={n:n.EventName,et:n.EventCategory,ua:n.UserAttributes,ui:n.UserIdentities,ia:n.IntegrationAttributes,str:n.Store,attrs:n.EventAttributes,sdk:n.SDKVersion,sid:n.SessionId,sl:n.SessionLength,dt:n.EventDataType,dbg:n.Debug,ct:n.Timestamp,lc:n.Location,o:n.OptOut,eec:n.ExpandedEventCount,av:n.AppVersion,cgid:n.ClientGeneratedId,das:n.DeviceId,mpid:n.MPID,smpids:n.currentSessionMPIDs},h=o(n.ConsentState);return h&&(u.con=h),n.EventDataType===f.AppStateTransition&&(u.fr=t,u.iu=!1,u.at=s.AppInit,u.lr=window.location.href||null,u.attrs=null),n.CustomFlags&&c(n,u),n.EventDataType===f.Commerce?(u.cu=r,n.ShoppingCart&&(u.sc={pl:e(n.ShoppingCart.ProductList)}),n.ProductAction?u.pd={an:n.ProductAction.ProductActionType,cs:i(n.ProductAction.CheckoutStep),co:n.ProductAction.CheckoutOptions,pl:e(n.ProductAction.ProductList),ti:n.ProductAction.TransactionId,ta:n.ProductAction.Affiliation,tcc:n.ProductAction.CouponCode,tr:i(n.ProductAction.TotalAmount),ts:i(n.ProductAction.ShippingAmount),tt:i(n.ProductAction.TaxAmount)}:n.PromotionAction?u.pm={an:n.PromotionAction.PromotionActionType,pl:n.PromotionAction.PromotionList.map(function(n){return{id:n.Id,nm:n.Name,cr:n.Creative,ps:n.Position?n.Position:0}})}:n.ProductImpressions&&(u.pi=n.ProductImpressions.map(function(n){return{pil:n.ProductImpressionList,pl:e(n.ProductList)}}))):n.EventDataType===f.Profile&&(u.pet=n.ProfileMessageType),u}var r=n("./types"),f=r.MessageType,s=r.ApplicationTransitionType,h=n("./constants"),u=n("./helpers"),i=n("./helpers").parseNumber;t.exports={createEventObject:a,convertEventToDTO:v,convertToConsentStateDTO:o}},{"./constants":3,"./helpers":9,"./types":21}],19:[function(n,t){function a(){var t,n;mParticle.Store.sessionId?(t=mParticle.Store.SDKConfig.sessionTimeout*6e4,new Date>new Date(mParticle.Store.dateLastEventSent.getTime()+t)?(h(),u()):(n=r.getPersistence(),n&&!n.cu&&(c.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null))):u()}function v(){return mParticle.Store.sessionId}function u(){var n,t,r;mParticle.Logger.verbose(i.InformationMessages.StartingNewSession);e.canLog()?(mParticle.Store.sessionId=e.generateUniqueId().toUpperCase(),n=mParticle.Identity.getCurrentUser(),t=n?n.getMPID():null,t&&(mParticle.Store.currentSessionMPIDs=[t]),mParticle.Store.sessionStartDate||(r=new Date,mParticle.Store.sessionStartDate=r,mParticle.Store.dateLastEventSent=r),f(),mParticle.Store.identifyCalled||(c.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null),s(o.MessageType.SessionStart)):mParticle.Logger.verbose(i.InformationMessages.AbandonStartSession)}function h(n){var u,t,h,c;if(mParticle.Logger.verbose(i.InformationMessages.StartingEndSession),n)s(o.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionAttributes={},r.update();else if(e.canLog()){if(t=r.getCookie()||r.getLocalStorage(),!t)return;if(t.gs&&!t.gs.sid){mParticle.Logger.verbose(i.InformationMessages.NoSessionToEnd);return}t.gs.sid&&mParticle.Store.sessionId!==t.gs.sid&&(mParticle.Store.sessionId=t.gs.sid);t.gs&&t.gs.les&&(u=mParticle.Store.SDKConfig.sessionTimeout*6e4,c=(new Date).getTime(),h=c-t.gs.les,h<u?f():(s(o.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionStartDate=null,mParticle.Store.sessionAttributes={},r.update()))}else mParticle.Logger.verbose(i.InformationMessages.AbandonEndSession)}function f(){var n=mParticle.Store.SDKConfig.sessionTimeout*6e4;mParticle.Store.globalTimer=window.setTimeout(function(){h()},n)}function y(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.sessionId||u(),l(),f())}function l(){clearTimeout(mParticle.Store.globalTimer)}var e=n("./helpers"),i=n("./constants").Messages,o=n("./types"),c=n("./identity").IdentityAPI,r=n("./persistence"),s=n("./events").logEvent;t.exports={initialize:a,getSession:v,startNewSession:u,endSession:h,setSessionTimer:f,resetSessionTimer:y,clearSessionTimeout:l}},{"./constants":3,"./events":6,"./helpers":9,"./identity":10,"./persistence":16,"./types":21}],20:[function(n,t){function f(n){var r={};for(var t in i.DefaultConfig)i.DefaultConfig.hasOwnProperty(t)&&(r[t]=i.DefaultConfig[t]);if(n)for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);for(t in i.DefaultUrls)r[t]=i.DefaultUrls[t];return r}function e(n,t){var h={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,migrationData:{},serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:"",identityCallInFlight:!1,SDKConfig:{},migratingToIDSyncCookies:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[]},o,e,s;for(o in h)this[o]=h[o];this.storageName=r.createMainStorageName(n.workspaceToken);this.prodStorageName=r.createProductStorageName(n.workspaceToken);this.integrationDelayTimeoutStart=Date.now();e=r.mergeConfigs(n,t);this.SDKConfig=f(e);e&&(e.hasOwnProperty("secureServiceUrl")&&(this.SDKConfig.secureServiceUrl=e.secureServiceUrl),e.hasOwnProperty("v2SecureServiceUrl")&&(this.SDKConfig.v2SecureServiceUrl=e.v2SecureServiceUrl),e.hasOwnProperty("identityUrl")&&(this.SDKConfig.identityUrl=e.identityUrl),e.hasOwnProperty("aliasUrl")&&(this.SDKConfig.aliasUrl=e.aliasUrl),e.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=e.logLevel),this.SDKConfig.useNativeSdk=e.hasOwnProperty("useNativeSdk")?e.useNativeSdk:!1,this.SDKConfig.isIOS=e.hasOwnProperty("isIOS")?e.isIOS:mParticle.isIOS||!1,this.SDKConfig.useCookieStorage=e.hasOwnProperty("useCookieStorage")?e.useCookieStorage:!1,this.SDKConfig.maxProducts=e.hasOwnProperty("maxProducts")?e.maxProducts:i.DefaultConfig.maxProducts,this.SDKConfig.maxCookieSize=e.hasOwnProperty("maxCookieSize")?e.maxCookieSize:i.DefaultConfig.maxCookieSize,e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),this.SDKConfig.integrationDelayTimeout=e.hasOwnProperty("integrationDelayTimeout")?e.integrationDelayTimeout:i.DefaultConfig.integrationDelayTimeout,e.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=e.identifyRequest),e.hasOwnProperty("identityCallback")&&(s=e.identityCallback,u.isFunction(s)?this.SDKConfig.identityCallback=e.identityCallback:mParticle.Logger.warning("The optional callback must be a function. You tried entering a(n) "+typeof s," . Callback not set. Please set your callback again.")),e.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=e.appVersion),e.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=e.sessionTimeout),this.SDKConfig.forceHttps=e.hasOwnProperty("forceHttps")?e.forceHttps:!0,e.hasOwnProperty("customFlags")&&(this.SDKConfig.customFlags=e.customFlags),e.hasOwnProperty("workspaceToken")&&(this.SDKConfig.workspaceToken=e.workspaceToken),e.hasOwnProperty("requiredWebviewBridgeName")?this.SDKConfig.requiredWebviewBridgeName=e.requiredWebviewBridgeName:e.hasOwnProperty("workspaceToken")&&(this.SDKConfig.requiredWebviewBridgeName=e.workspaceToken),e.hasOwnProperty("minWebviewBridgeVersion")&&(this.SDKConfig.minWebviewBridgeVersion=e.minWebviewBridgeVersion),this.SDKConfig.aliasMaxWindow=e.hasOwnProperty("aliasMaxWindow")?e.aliasMaxWindow:i.DefaultConfig.aliasMaxWindow)}var i=n("./constants"),r=n("./helpers"),u=r.Validators;t.exports=e},{"./constants":3,"./helpers":9}],21:[function(n,t){var f={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,getName:function(n){switch(n){case f.Navigation:return"Navigation";case f.Location:return"Location";case f.Search:return"Search";case f.Transaction:return"Transaction";case f.UserContent:return"User Content";case f.UserPreference:return"User Preference";case f.Social:return"Social";case u.ProductAddToCart:return"Product Added to Cart";case u.ProductAddToWishlist:return"Product Added to Wishlist";case u.ProductCheckout:return"Product Checkout";case u.ProductCheckoutOption:return"Product Checkout Options";case u.ProductClick:return"Product Click";case u.ProductImpression:return"Product Impression";case u.ProductPurchase:return"Product Purchased";case u.ProductRefund:return"Product Refunded";case u.ProductRemoveFromCart:return"Product Removed From Cart";case u.ProductRemoveFromWishlist:return"Product Removed from Wishlist";case u.ProductViewDetail:return"Product View Details";case u.PromotionClick:return"Promotion Click";case u.PromotionView:return"Promotion View";default:return"Other"}}},u={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},i={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12},r,e,o,s;i.isValid=function(n){if(typeof n=="number")for(var t in i)if(i.hasOwnProperty(t)&&i[t]===n)return!0;return!1};i.getName=function(n){switch(n){case window.mParticle.IdentityType.CustomerId:return"Customer ID";case window.mParticle.IdentityType.Facebook:return"Facebook ID";case window.mParticle.IdentityType.Twitter:return"Twitter ID";case window.mParticle.IdentityType.Google:return"Google ID";case window.mParticle.IdentityType.Microsoft:return"Microsoft ID";case window.mParticle.IdentityType.Yahoo:return"Yahoo ID";case window.mParticle.IdentityType.Email:return"Email";case window.mParticle.IdentityType.FacebookCustomAudienceId:return"Facebook App User ID";default:return"Other ID"}};i.getIdentityType=function(n){switch(n){case"other":return i.Other;case"customerid":return i.CustomerId;case"facebook":return i.Facebook;case"twitter":return i.Twitter;case"google":return i.Google;case"microsoft":return i.Microsoft;case"yahoo":return i.Yahoo;case"email":return i.Email;case"facebookcustomaudienceid":return i.FacebookCustomAudienceId;case"other1":return i.Other1;case"other2":return i.Other2;case"other3":return i.Other3;case"other4":return i.Other4;default:return!1}};i.getIdentityName=function(n){switch(n){case i.Other:return"other";case i.CustomerId:return"customerid";case i.Facebook:return"facebook";case i.Twitter:return"twitter";case i.Google:return"google";case i.Microsoft:return"microsoft";case i.Yahoo:return"yahoo";case i.Email:return"email";case i.FacebookCustomAudienceId:return"facebookcustomaudienceid";case i.Other1:return"other1";case i.Other2:return"other2";case i.Other3:return"other3";case i.Other4:return"other4"}};r={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10};r.getName=function(n){switch(n){case r.AddToCart:return"Add to Cart";case r.RemoveFromCart:return"Remove from Cart";case r.Checkout:return"Checkout";case r.CheckoutOption:return"Checkout Option";case r.Click:return"Click";case r.ViewDetail:return"View Detail";case r.Purchase:return"Purchase";case r.Refund:return"Refund";case r.AddToWishlist:return"Add to Wishlist";case r.RemoveFromWishlist:return"Remove from Wishlist";default:return"Unknown"}};r.getExpansionName=function(n){switch(n){case r.AddToCart:return"add_to_cart";case r.RemoveFromCart:return"remove_from_cart";case r.Checkout:return"checkout";case r.CheckoutOption:return"checkout_option";case r.Click:return"click";case r.ViewDetail:return"view_detail";case r.Purchase:return"purchase";case r.Refund:return"refund";case r.AddToWishlist:return"add_to_wishlist";case r.RemoveFromWishlist:return"remove_from_wishlist";default:return"unknown"}};e={Unknown:0,PromotionView:1,PromotionClick:2};e.getName=function(n){switch(n){case e.PromotionView:return"view";case e.PromotionClick:return"click";default:return"unknown"}};e.getExpansionName=function(n){switch(n){case e.PromotionView:return"view";case e.PromotionClick:return"click";default:return"unknown"}};o={Logout:3};s={AppInit:1};t.exports={MessageType:{SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16},EventType:f,CommerceEventType:u,IdentityType:i,ProfileMessageType:o,ApplicationTransitionType:s,ProductActionType:r,PromotionActionType:e}},{}]},{},[13]) ;

(function(n){var t="GoogleAnalyticsEventForwarder",r={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,Commerce:16},e=1,u="Google.NonInteraction",o="Google.Category",s="Google.Label",f="Google.Page",h="Google.Value",i="Google.HitType",c=function(){function ft(){return"mpgaTracker"+e++}function c(n){return g+"."+n}function it(n){return mParticle.EventType.getName(n)}function y(n){return n.replace(/ /g,"").toLowerCase()}function et(n,t){n.EventAttributes&&Object.keys(n.EventAttributes).length&&v(n.EventAttributes,t,b);n.UserAttributes&&Object.keys(n.UserAttributes).length&&v(n.UserAttributes,t,k)}function v(n,t,i){var r,u;for(r in i.customDimensions)for(attrName in n)i.customDimensions[r]===attrName&&(t[r]=n[attrName]);for(u in i.customMetrics)for(attrName in n)i.customMetrics[u]===attrName&&(t[u]=n[attrName])}function ot(n,t){n.hasOwnProperty(u)&&(t.nonInteraction=n[u])}function st(n){var i={},u=!1;if(nt){n.ExpandedEventCount=0;et(n,i);n.CustomFlags&&Object.keys(n.CustomFlags).length&&ot(n.CustomFlags,i);try{return n.EventDataType==r.PageView?(at(n,i,n.CustomFlags),u=!0):n.EventDataType==r.Commerce?(lt(n,i,n.CustomFlags),u=!0):n.EventDataType==r.PageEvent&&(u=!0,vt(n,i,n.CustomFlags)),u&&tt&&tt(rt,n),"Successfully sent to "+t}catch(f){return"Failed to send to: "+t+" "+f}}return"Can't send to forwarder "+t+", not initialized"}function ht(i,r){if(nt)l.useCustomerId=="True"&&r==n.mParticle.IdentityType.CustomerId&&(l.classicMode=="True"||ga(c("set"),"userId",n.mParticle.generateHash(i)));else return"Can't call setUserIdentity on forwarder "+t+", not initialized"}function d(n,t){var r={id:n.Sku,name:n.Name,category:n.Category,brand:n.Brand,variant:n.Variant,price:n.Price,coupon:n.CouponCode,quantity:n.Quantity};for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);ga(c("ec:addProduct"),r)}function ct(n){ga(c("ec:addImpression"),{id:n.Sku,name:n.Name,type:"view",category:n.Category,brand:n.Brand,variant:n.Variant})}function p(n,t,r){ga(c("send"),r&&r[i]?r[i]:"event","eCommerce",it(n),t)}function lt(n,t,r){if(ut||(ga(c("require"),"ec"),ut=!0),n.CurrencyCode&&ga(c("set"),"&cu",n.CurrencyCode),n.ProductImpressions)n.ProductImpressions.forEach(function(n){n.ProductList.forEach(function(n){ct(n)})}),p(n.EventCategory,t,r);else if(n.PromotionAction)n.PromotionAction.PromotionList.forEach(function(n){ga(c("ec:addPromo"),{id:n.Id,name:n.Name,creative:n.Creative,position:n.Position})}),n.PromotionAction.PromotionActionType==mParticle.PromotionType.PromotionClick&&ga(c("ec:setAction"),"promo_click"),p(n.EventDataType,t,r);else if(n.ProductAction)if(n.ProductAction.ProductActionType==mParticle.ProductActionType.Purchase)n.ProductAction.ProductList.forEach(function(n){var t={};v(n.Attributes,t,a);d(n,t)}),ga(c("ec:setAction"),"purchase",{id:n.ProductAction.TransactionId,affiliation:n.ProductAction.Affiliation,revenue:n.ProductAction.TotalAmount,tax:n.ProductAction.TaxAmount,shipping:n.ProductAction.ShippingAmount,coupon:n.ProductAction.CouponCode}),p(n.EventDataType,t,r);else if(n.ProductAction.ProductActionType==mParticle.ProductActionType.Refund)n.ProductAction.ProductList.length&&n.ProductAction.ProductList.forEach(function(n){var t={id:n.Sku,quantity:n.Quantity};v(n.Attributes,t,a);ga(c("ec:addProduct"),t)}),ga(c("ec:setAction"),"refund",{id:n.ProductAction.TransactionId}),p(n.EventDataType,t,r);else if(n.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart||n.ProductAction.ProductActionType==mParticle.ProductActionType.RemoveFromCart){var u={};n.ProductAction.ProductList.forEach(function(n){v(n.Attributes,u,a);d(n,u)});ga(c("ec:setAction"),n.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart?"add":"remove");p(n.EventDataType,t,r)}else n.ProductAction.ProductActionType==mParticle.ProductActionType.Checkout?(n.ProductAction.ProductList.forEach(function(n){var t={};v(n.Attributes,t,a);d(n,t)}),ga(c("ec:setAction"),"checkout",{step:n.ProductAction.CheckoutStep,option:n.ProductAction.CheckoutOptions}),p(n.EventDataType,t,r)):n.ProductAction.ProductActionType==mParticle.ProductActionType.Click?(n.ProductAction.ProductList.forEach(function(n){var t={};v(n.Attributes,t,a);d(n,t)}),ga(c("ec:setAction"),"click"),p(n.EventDataType,t,r)):n.ProductAction.ProductActionType==mParticle.ProductActionType.ViewDetail&&(n.ProductAction.ProductList.forEach(function(n){v(n.Attributes,{},a);d(n)}),ga(c("ec:setAction"),"detail"),ga(c("send"),r&&r[i]?r[i]:"event","eCommerce",it(n.EventCategory),t))}function at(n,t,r){l.classicMode=="True"?_gaq.push(["_trackPageview"]):(n.CustomFlags&&n.CustomFlags[f]&&ga(c("set"),"page",n.CustomFlags[f]),ga(c("send"),r&&r[i]?r[i]:"pageview",t))}function vt(n,t,r){var f="",e=it(n.EventCategory),u;if(n.EventAttributes&&(n.EventAttributes.label&&(f=n.EventAttributes.label),n.EventAttributes.value&&(u=parseInt(n.EventAttributes.value,10),u!=u&&(u=null)),n.EventAttributes.category&&(e=n.EventAttributes.category)),n.CustomFlags){var v=n.CustomFlags[o],y=n.CustomFlags[s],a=parseInt(n.CustomFlags[h],10);v&&(e=v);y&&(f=y);a==a&&(u=a)}l.classicMode=="True"?_gaq.push(["_trackEvent",e,n.EventName,f,u]):ga(c("send"),r&&r[i]?r[i]:"event",e,n.EventName,f,u,t)}function w(n,t){var i=t.customDimensions[y(n.value)];i&&console.log("Warning: both "+i+" & "+n.map+" are mapped to "+n.value+". "+n.map+" is replacing "+i+". If this is a mistake, please revisit the Google Analytics settings at app.mparticle.com. Otherwise, please ignore this warning.")}function yt(i,r,u,f){var e,o,s;try{return l=i,tt=r,isTesting=u,g=f?f:ft(),l.classicMode=="True"?(n._gaq=n._gaq||[],u!==!0&&(n._gaq.push(["_setAccount",l.apiKey]),l.useLocalhostCookie=="True"&&n._gaq.push(["_setDomainName","none"]),function(){var n=document.createElement("script"),t;n.type="text/javascript";n.async=!0;n.src=l.useDisplayFeatures=="True"?("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}())):(u!==!0&&function(n,t,i,r,u,f,e){n.GoogleAnalyticsObject=u;n[u]=n[u]||function(){(n[u].q=n[u].q||[]).push(arguments)};n[u].l=1*new Date;f=t.createElement(i);e=t.getElementsByTagName(i)[0];f.async=1;f.src=r;e.parentNode.insertBefore(f,e)}(n,document,"script","//www.google-analytics.com/analytics.js","ga"),e={trackingId:l.apiKey,name:g},l.useLocalhostCookie=="True"&&(e.cookieDomain="none"),l.clientIdentificationType==="AMP"&&(e.useAmpClientId=!0),ga("create",e),l.useDisplayFeatures=="True"&&ga(c("require"),"displayfeatures"),l.useSecure=="True"&&ga(c("set"),"forceSSL",!0),l.customDimensions&&(o=JSON.parse(l.customDimensions.replace(/&quot;/g,'"')),o.forEach(function(n){n.maptype==="EventAttributeClass.Name"?(w(n,b),b.customDimensions[y(n.value)]=n.map):n.maptype==="UserAttributeClass.Name"?(w(n,k),k.customDimensions[y(n.value)]=n.map):n.maptype==="ProductAttributeSelector.Name"&&(w(n,a),a.customDimensions[y(n.value)]=n.map)})),l.customMetrics&&(s=JSON.parse(l.customMetrics.replace(/&quot;/g,'"')),s.forEach(function(n){n.maptype==="EventAttributeClass.Name"?(w(n,b),b.customMetrics[y(n.value)]=n.map):n.maptype==="UserAttributeClass.Name"?(w(n,k),k.customMetrics[y(n.value)]=n.map):n.maptype==="ProductAttributeSelector.Name"&&(w(n,a),a.customMetrics[y(n.value)]=n.map)}))),nt=!0,"Successfully initialized: "+t}catch(h){return"Failed to initialize: "+t}}var rt=this,nt=!1,ut=!1,l,tt,g=null,b={customDimensions:{},customMetrics:{}},k={customDimensions:{},customMetrics:{}},a={customDimensions:{},customMetrics:{}};rt.name=t;this.init=yt;this.process=st;this.setUserIdentity=ht};n&&n.mParticle&&n.mParticle.addForwarder&&n.mParticle.addForwarder({name:t,constructor:c})})(window) ;

(function(n){var t="DynamicYield",i={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,Commerce:16},r=function(){function c(i,u,s){e=u;o=i;try{if(s||n.DY&&n.DY.API)f=!0;else{var c=document.createElement("script");c.type="text/javascript";c.async=!1;c.src="https://cdn.dynamicyield.com/api/"+o.siteId+"/api_dynamic.js";c.setAttribute("id","DYdynamic");(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(c);c.onload=function(){var n=document.createElement("script");n.type="text/javascript";n.async=!1;n.src="https://cdn.dynamicyield.com/api/"+o.siteId+"/api_static.js";(document.getElementById("DYdynamic")[0]||document.getElementsByTagName("body")[0]).appendChild(n);n.onload=function(){if(f=!0,DY&&DY.API&&r.length>0){for(var n=0;n<r.length;n++)h(r[n]);r=[]}}}}return t+" successfully loaded"}catch(l){return"Failed to initialize: "+l}}function h(n){var u=!1;if(f)try{return n.EventDataType===i.Commerce&&n.EventCategory===mParticle.CommerceEventType.ProductPurchase?u=l(n):n.EventDataType===i.Commerce&&n.EventCategory===mParticle.CommerceEventType.ProductAddToCart?u=v(n):n.EventDataType===i.Commerce&&n.EventCategory===mParticle.CommerceEventType.ProductRemoveFromCart?u=w(n):n.EventDataType===i.Commerce&&n.EventCategory===mParticle.CommerceEventType.ProductAddToWishlist?u=p(n):n.EventDataType===i.PageEvent&&n.EventCategory===mParticle.EventType.Search?u=b(n):n.EventDataType===i.PageEvent&&(u=a(n)),u===!0&&e?(e(s,n),"Successfully sent to "+t):"Error logging event or event type not supported - "+u.error}catch(o){return"Failed to send to: "+t+" "+o}else r.push(n);return"Can't send to forwarder "+t+", not initialized. Event added to queue."}function l(n){var r=u(n.ProductAction.ProductList),t={uniqueTransactionId:n.ProductAction.TransactionId,dyType:"purchase-v1",value:n.ProductAction.TotalAmount,cart:r},i;n.CurrencyCode&&(t.currency=n.CurrencyCode);for(i in n.EventAttributes)t[i]=n.EventAttributes[i];return DY.API("event",{name:"Purchase",properties:t}),!0}function a(n){var t={};for(var i in n.EventAttributes)t[i]=n.EventAttributes[i];return DY.API("event",{name:n.EventName,properties:t}),!0}function u(n){var t={Sku:1,Quantity:1,Price:1};return n.map(function(n){var r={productId:n.Sku,quantity:Number(n.Quantity),itemPrice:Number(n.Price)};for(var i in n.Attributes)t[i]||(r[i]=n.Attributes[i]);return r})}function v(n){var i={quantity:1,productId:1,currency:1,itemPrice:1},r=u(n.ProductAction.ProductList),t=u(n.ShoppingCart.ProductList);return r.forEach(function(r){var u={dyType:"add-to-cart-v1",value:r.quantity*r.itemPrice,productId:r.productId,quantity:Number(r.quantity)},f;n.CurrencyCode&&(u.currency=n.CurrencyCode);t=t.concat(r);u.cart=t;for(f in r)i[f]||(u[f]=r[f]);DY.API("event",{name:"Add to Cart",properties:u})}),!0}function y(t){function u(n){DY.API("event",{name:"Login",properties:n})}function f(n){var t=new TextEncoder("utf-8").encode(n);return crypto.subtle.digest("SHA-256",t).then(function(n){return e(n)})}function e(n){for(var i=[],r=new DataView(n),t=0;t<r.byteLength;t+=4){var f=r.getUint32(t),e=f.toString(16),u="00000000",o=(u+e).slice(-u.length);i.push(o)}return i.join("")}var r={dyType:"login-v1"},i=t.getUserIdentities().userIdentities;(i.customerid||i.email)&&(i.customerid&&(r.cuid=i.customerid,r.cuidType="customerid"),i.email&&n.crypto&&n.crypto.subtle&&n.crypto.subtle.digest?f(i.email.toLowerCase()).then(function(n){r.hashedEmail=n;u(r)}):u(r))}function p(n){n.ProductAction&&n.ProductAction.ProductList&&n.ProductAction.ProductList.forEach(function(n){var i={dyType:"add-to-wishlist-v1",productId:n.Sku};for(var t in n.Attributes)t!=="Sku"&&(i[t]=n.Attributes[t]);DY.API("event",{name:"Add to Wishlist",properties:i})})}function w(n){var f={quantity:1,productId:1,currency:1},t=n.ProductAction.ProductList[0],r={dyType:"remove-from-cart-v1",value:t.Quantity*t.Price,productId:t.Sku,quantity:Number(t.Quantity),cart:u(n.ShoppingCart.ProductList).filter(function(n){return n.productId!==t.Sku})},i;n.CurrencyCode&&(r.currency=n.CurrencyCode);for(i in t.Attributes)f[i]||(r[i]=t.Attributes[i]);return DY.API("event",{name:"Remove from Cart",properties:r}),!0}function b(n){var t={dyType:"keyword-search-v1"};for(key in n.EventAttributes)t[key]=n.EventAttributes[key];DY.API("event",{name:"Keyword Search",properties:t})}var s=this,f=!1,e,o,r=[];s.name=t;this.init=c;this.process=h;this.onUserIdentified=y};n&&n.mParticle&&n.mParticle.addForwarder&&n.mParticle.addForwarder({name:t,constructor:r})})(window) ;


    ;window.mParticle.configureForwarder({"name":"GoogleAnalyticsEventForwarder","moduleId":6,"isDebug":true,"isVisible":true,"isDebugString":"true","hasDebugString":"false","settings":{"useCustomerId":"False","apiKey":"UA-124444714-1","classicMode":"False","useLocalhostCookie":"False","customDimensions":"[{&quot;jsmap&quot;:null,&quot;map&quot;:&quot;Product Name&quot;,&quot;maptype&quot;:&quot;EventAttributeClass.Name&quot;,&quot;value&quot;:&quot;Dimension 6&quot;}]","enableEnhancedEcommerce":"True","customMetrics":"[]","lateEventAction":"Send","defaultApplicationName":null,"sendUserIPAddress":"False","clientIdentificationType":"Default"},"screenNameFilters":[],"screenAttributeFilters":[],"userIdentityFilters":[],"userAttributeFilters":[],"eventNameFilters":[],"eventTypeFilters":[],"attributeFilters":[],"githubPath":null,"filteringEventAttributeValue":null,"filteringUserAttributeValue":null,"filteringConsentRuleValues":null,"consentRegulationFilters":[],"consentRegulationPurposeFilters":[],"messageTypeFilters":[],"messageTypeStateFilters":[],"eventSubscriptionId":30225,"excludeAnonymousUser":false});

    ;window.mParticle.configureForwarder({"name":"GoogleAnalyticsEventForwarder","moduleId":6,"isDebug":false,"isVisible":true,"isDebugString":"false","hasDebugString":"true","settings":{"useCustomerId":"False","apiKey":"UA-124444714-1","classicMode":"False","useLocalhostCookie":"False","customDimensions":"[{&quot;jsmap&quot;:null,&quot;map&quot;:&quot;Product Name&quot;,&quot;maptype&quot;:&quot;EventAttributeClass.Name&quot;,&quot;value&quot;:&quot;Dimension 6&quot;}]","enableEnhancedEcommerce":"True","customMetrics":"[]","lateEventAction":"Send","defaultApplicationName":null,"sendUserIPAddress":"False","clientIdentificationType":"Default"},"screenNameFilters":[],"screenAttributeFilters":[],"userIdentityFilters":[],"userAttributeFilters":[],"eventNameFilters":[],"eventTypeFilters":[],"attributeFilters":[],"githubPath":null,"filteringEventAttributeValue":null,"filteringUserAttributeValue":null,"filteringConsentRuleValues":null,"consentRegulationFilters":[],"consentRegulationPurposeFilters":[],"messageTypeFilters":[],"messageTypeStateFilters":[],"eventSubscriptionId":30225,"excludeAnonymousUser":false});

    ;window.mParticle.configureForwarder({"name":"DynamicYield","moduleId":128,"isDebug":true,"isVisible":true,"isDebugString":"true","hasDebugString":"false","settings":{"siteId":"8770734"},"screenNameFilters":[],"screenAttributeFilters":[],"userIdentityFilters":[],"userAttributeFilters":[],"eventNameFilters":[],"eventTypeFilters":[],"attributeFilters":[],"githubPath":null,"filteringEventAttributeValue":null,"filteringUserAttributeValue":null,"filteringConsentRuleValues":null,"consentRegulationFilters":[],"consentRegulationPurposeFilters":[],"messageTypeFilters":[],"messageTypeStateFilters":[],"eventSubscriptionId":30469,"excludeAnonymousUser":false});

    ;window.mParticle.configureForwarder({"name":"DynamicYield","moduleId":128,"isDebug":false,"isVisible":true,"isDebugString":"false","hasDebugString":"true","settings":{"siteId":"8770734"},"screenNameFilters":[],"screenAttributeFilters":[],"userIdentityFilters":[],"userAttributeFilters":[],"eventNameFilters":[],"eventTypeFilters":[],"attributeFilters":[],"githubPath":null,"filteringEventAttributeValue":null,"filteringUserAttributeValue":null,"filteringConsentRuleValues":null,"consentRegulationFilters":[],"consentRegulationPurposeFilters":[],"messageTypeFilters":[],"messageTypeStateFilters":[],"eventSubscriptionId":30469,"excludeAnonymousUser":false});

if (window.mParticle.hasOwnProperty('configurePixel')) {

}

delete window.mParticle.addForwarder;
delete window.mParticle.configureForwarder;
if (window.mParticle.hasOwnProperty('configurePixel')) {
    delete window.mParticle.configurePixel;
}

mParticle.init('35e16c82a8f86d4886873364c2c21180');